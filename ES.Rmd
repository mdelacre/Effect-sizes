---
title             : "What measure of effect size using when performing a Welch's t-test?"
shorttitle        : "Effect size"
author: 
  - name          : "Marie Delacre" 
    affiliation   : "1"
    corresponding : yes    
    address       : "CP191, avenue F.D. Roosevelt 50, 1050 Bruxelles"
    email         : "marie.delacre@ulb.ac.be"
  - name          : "Daniel Lakens"
    affiliation   : "2"
  - name          : "Christophe Ley"
    affiliation   : "3"
  - name          : "Limin Liu"
    affiliation   : "3"
  - name          : "Christophe Leys"
    affiliation   : "1"
    
affiliation:
  - id            : "1"
    institution   : "Université Libre de Bruxelles, Service of Analysis of the Data (SAD), Bruxelles, Belgium"
  - id            : "2"
    institution   : "Eindhoven University of Technology, Human Technology Interaction Group, Eindhoven, the Netherlands"
  - id            : "3"
    institution   : "Universiteit Gent, Department of Applied Mathematics, Computer Science and Statistics,4 Gent, Belgium"

authornote: |
abstract: |
keywords          : "keywords"
wordcount         : "X"
bibliography      : ["r-references.bib"]
floatsintext      : yes
figurelist        : no
tablelist         : no
footnotelist      : no
linenumbers       : yes
mask              : no 
draft             : no
documentclass     : "apa6"
classoption       : "man"
output:
  papaja::apa6_pdf:
    includes:
      extra_dependencies: ["float"]
    
header-includes:
  - \usepackage{rotating}
  - \DeclareDelayedFloatFlavor{sidewaysfigure}{figure}     
  - \usepackage{lscape}
  - \newcommand{\blandscape}{\begin{landscape}}
  - \newcommand{\elandscape}{\end{landscape}}
---

```{r setup, include = FALSE}
library("papaja")
library("knitr")
```

```{r analysis-preferences}
# Seed for random number generation
set.seed(42)
knitr::opts_chunk$set(cache.extra = knitr::rand_seed)
```

# Intro

During decades, researchers in social science [@Henson_Smith_2000] and education [@Fan_2001] have overestimated the ability of the null hypothesis (H0) testing to determine the importance of their results. The standard for researchers in social science is to define H0 as the absence of effect [@Meehl_1990]. For example, when comparing the mean of two groups, researchers commonly test the H0 that there is no mean difference between groups [@Steyn_2000]. Any effect that is significantly different from zero will be seen as sole support for a theory. 

Such an approach has faced many criticisms among which the most relevant to our concern is that the null hypothesis testing highly depends on sample size: for a given alpha level and a given difference between groups, the larger the sample size, the higher the probability of rejecting the null hypothesis [@Fan_2001; @Sullivan_Feinn_2012; @Olejnik_Algina_2000; @Kirk_2009]. It implies that even tiny differences could be detected as statistically significant with very large sample sizes [@McBride_et_al_1993]\footnote{Tiny differences might be due to sampling error, or to other factors than the one of interest: even under the assumption of random assignent (which is a necessary but not sufficient condition), it is almost impossible to be sure that the only difference between two conditions is the one defined by the factor of interest. Other tiny factors of no theoretical interest might slightly influence results, making the probability of getting an actual zero effect very low. This is what Meehl (1990) calls 'systematic noise'.}. 

Facing this argument, it has become an adviced practice to report the *p*-value assorted by a measure of the effect size, that is, a quantitative measure of the magnitude of the experimental effect [@Fan_2001; @Hays_1963;@Cohen_1965]. This practice is also highly endorsed by the American Psychological Association (APA) and the American Educational Research Association (AERA) [@APA_2010;@AERA_2006]. However, only a limited number of studies have properly reported effect size in the last decades. 

Generally, there is a high confusion between the effect size and other related concepts such as the Clinical significance. Moreover, there are several situations that call for effect size measures and, in the current litterature, it is not always easy to know which measure to use in which context. We will therefore begin this paper with 3 sections in which we will:   
1. Clearly define what is a measure of effect size;  
2. List the different situations that call for effect sizes measures;  
3. Define required properties of the effect size estimators depending on the specific situation. 

Moreover, it is highly recommended to compute a confidence interval around the point effect size. In a fourth section, we will therefore summarize in how far it is an added value to mention the confidence interval around the effect size.

After these general adjustments, we will focus our attention on “between-subject” designs where individuals are randomly assigned into one of two independent groups and group scores are compared based on their means\footnote{We made this choice because *t*-tests are still the most commonly used tests in the field of Psychology.}. Because it has been widely argued that there are many fields in psychology where the assumption of equal variances between two populations is ecologically unlikely [@Erceg-Hurn_Mirosevich_2008; @Grissom_2000; @Delacre_et_al_2017], it is becoming more common in statistical software to present a *t*-test that does not hold under this assumption by default, namely the Welch’s *t*-test (e.g., R, Minitab). However, similar issues for the measures of effect sizes have received less attention [@Shieh_2013], and Cohen’s $d_s$ remains persistent\footnote{For example, in Jamovi, Cohen's ds is provided, independently of whether one performs Student's or Welch's t-test.}. One possible reason is that researchers cannot find a consensus on which alternative should be used [@Shieh_2013]. We will limit our study to the standardized mean difference, called the *d*-family, because it is the dominant family of estimators of effect size when comparing two groups based on their means [@Peng_et_al_2013; @Shieh_2013], and we will see that even in this very specific context, there is little agreement between researchers as to which is the most suitable estimator. According to us, the main reason is that it is difficult, based on currently existing measures, to optimally serve all the purposes of an effect size measure. Throughout this section, we will:  
1. Present the main measures of the *d*-family that are proposed in the literature,related to the purpose they serve, and introduce a new one, namely the "transformed Shieh's *d*" that should help at reaching all the purposes simultaneously;  
2. Present and discuss the results of simulations we performed, in order to compare existing measures and our newly introduced one;    
3. Summarize our conclusions in practical recommendations. In this section, we will provide useful tools (i.e., an R package) to compute relevant measures of effect sizes and related information.

# Measure of effect size: what it is, what it is not 

The effect size is commonly referred to as the practical significance of a test. @Grissom_and_kim_2005 define the effect size as the extent to which results differ from what is implied by the null hypothesis. In the context of the comparison of two groups based on their means, depending on the defined null hypothesis (considering the absence of effect as the null hypothesis), we could define the effect size either as the magnitude of differences between parameters of two populations groups are extracted from [e.g. the mean; @Peng_and_Chen_2014] or as the magnitude of the relation between one dichotomous factor and one dependent variable [@AERA_2006]. Both definitions refer to the most famous families of measures of effect sizes [@Rosenthal_1994]:  the *d*-family and the *r*-family.

Very often, the contribution of the measures of effect size is overestimated. First, benchmarks about what should be a small, medium or large effect size might have contributed to viewing the effect size as a measure of the importance or the relevance of an effect in real life, but it is not [@Stout_Ruble_1995]. The effect size is only a mathematical indicator of the magnitude of a difference, which depends on the way a variable is converted into numerical indicator. In order to assess the meaningfulness of an effect, we should be able to relate this effect with behaviors/meaningful consequences in the real world [@Andersen_et_al_2007]. For example, let us imagine a sample of students in serious school failure who are randomly divided into two groups: an experimental group following a training program and a control group. At the end of the training, students in the experimental group have on average significantly higher scores on a test than students in the control group, and the difference is large (e.g. 30 percents). Does it automatically mean that students in the experimental condition will be able to pass to the next grade and to continue normal schooling? Whether the computed magnitude of difference is an important, meaningful change in everyday life refers to the interpretation of treatment outcomes and is neither a statistical nor mathematical concept, but is related to the underlying theory that posits an empirical hypothesis. This concept is sometimes called *Clinical significance* [@Thompson_2002; @Grissom_and_Kim_2012] or *Social significance* [@Tyler_1931] in the current literature. However, in our conception, we should use a more general term and we propose to rename this concept to *Applied significance*\footnote{In our conception Applied significance encompasses all what refers to the relevance of an effect in real life, such as for instance clinical, personnal, social, professionnal relevance}.  
 
Second, in the context of the comparison of two groups based on their means, the effect size should not replace the null hypothesis testing. Statistical testing allows the researcher to determine whether the oberved departure from H0 occured by chance or not [@Stout_Ruble_1995], while effect size estimators allow to assess the practical signficance of an effect, and as reminds @Fan_2001:  *"a practically meaningful outcome may also have occured by chance, and consequently, is not trustworthy"* (p.278). For this reason, the use of confidence intervals around the effect size estimate is highly recommended [@Bothe_Richardson_2011]. 

# Different purposes of effect size measures

Effect size measures can be used in an *inferential* perspective:   
- The effect sizes from previous studies can be used in a prior power analysis when planning a new study [@Sullivan_Feinn_2012;@Lakens_2013;@Stout_Ruble_1995;@Prentice_Miller_1992; @Wilkinson_1999];  
- We can compute confidence limits around the point estimator [@Shieh_2013] in order to replace conventional hypothesis testing : if the null hypothesis area is out of the confidence interval, we can conclude that the null hypothesis is false. 

Measures of effect size can also be used in a *comparative* perspective, that is, to assess the stability of results across designs, analysis, samples sizes [@Wilkinson_1999]. This includes    
- the comparison of results from 2 or more studies [@Prentice_Miller_1992];  
- the incorporation of results in meta-analysis [@Lakens_2013;@Wilkinson_1999;@Stout_Ruble_1995; @Nakagawa_and_Cuthill_2007;@Li_2016].  

Finally, effect size measures can be used for *interpretative* purposes, namely to assess the practical significance of a result [beyond statistical significance; @Lakens_2013;@Prentice_Miller_1992;@APA_2010].  

# Properties of a good effect size estimator

The empirical value of an estimator (called estimate) depends on the sampling, in other words, different samples extracted from the same population will of course lead to different estimates for a same estimator. The *sampling distribution* of the estimator is the distribution of all estimates, based on all possible samples of size *n* extracted from one population. Studying the sampling distribution is very useful, as it allows us to assess the qualities of estimator. More specifically, three desirable properties a good estimator should possess for inferential purposes are: **unbiasedness**, **consistency** and **efficiency** [@Wackerly_et_al_2008].

An estimator is unbiased if the distribution of estimates is centered around the true population parameter. On the other hand, an estimator is positively (or negatively) biased if the distribution is centered around a value that is higher (or smaller) than the true population parameter (see Figure \ref{fig:BIAS}). In other words, the bias tells us if estimates are good, on average. The *bias* of a point estimator $\hat{\delta}$ can be computed as

\begin{equation} 
\hat{\delta}_{bias}=E(\hat{\delta})-\delta
(\#eq:BIAS)
\end{equation} 

where $E(\hat{\delta})$ is the expectation of the sampling distribution of the estimator (i.e. the population average) and $\delta$ is the true (population) parameter. 

```{r "BIAS", echo=FALSE, fig.width = 15,fig.height=8,out.width = '400px',fig.cap = "Samplig distribution for a positively biased (left), an unbiased (center) and a negatively biased estimator (right)"}
par(mai=c(.5,1,.5,1),mfrow=c(1,3),cex.axis=2)
plot(function(x) dnorm(x,mean=2,sd=2),-6, 10,xlab="",ylab="",main ="",axes=F,lty=1,xlim=c(-6,10),ylim=c(0,.2),lwd=1,cex.lab=1.2)
segments(2,0,2,dnorm(2,mean=2,sd=2))
segments(0,0,0,dnorm(0,mean=2,sd=2),lty=2,lwd=2)
axis(side=1,at=seq(-6,10,2),labels=c(rep("",3),expression(delta),expression(paste("E(",hat(delta),")")),rep("",4)),col="white",cex=2)
plot(function(x) dnorm(x,mean=0,sd=2),-8, 8,xlab="",ylab="",main ="",axes=F,lty=1,xlim=c(-8,8),ylim=c(0,.2),lwd=1,cex.lab=1.2)
segments(0,0,0,dnorm(0,mean=0,sd=2))
segments(0,0,0,dnorm(0,mean=0,sd=2),lty=2,lwd=2)
axis(side=1,at=seq(-6,10,2),col="white",labels=c(rep("",3),expression(paste(delta,"=E(",hat(delta),")")),rep("",5)))
plot(function(x) dnorm(x,mean=-2,sd=2),-10, 6,xlab="",ylab="",main ="",axes=F,lty=1,xlim=c(-10,6),ylim=c(0,.2),lwd=1,cex.lab=1.2)
segments(-2,0,-2,dnorm(2,mean=2,sd=2))
segments(0,0,0,dnorm(0,mean=2,sd=2),lty=2,lwd=2)
axis(side=1,at=seq(-6,10,2),labels=c(rep("",2),expression(paste("E(",hat(delta),")")),expression(delta),rep("",5)),col="white")
```

Moreover, since there is a strong relationship between the bias and the size of any estimator (the larger an estimator, the larger the bias), it might be interesting to also define the *relative bias* as the ratio between the bias and the population parameter:

\begin{equation} 
\hat{\delta}_{relative \; bias}=\frac{E(\hat{\delta})-\delta}{\delta}
(\#eq:RELBIAS)
\end{equation} 

While the bias informs us about the quality of estimates on average, in particular their capacity of lying close to the true value, it says nothing about individual estimates. Imagine a situation where the distribution of estimates is centered around the real parameter but with such a large variance that some point estimates are very far from the center. This would be problematic, since we then do not know if this estimate, based on the sample at hand, is close to the truth or far off. Therefore it is not only essential for an estimator to be unbiased, but the variability of its sampling distribution should also ideally be small. Put simply, we hope that *all* possible estimates are close enough of the true population parameter, in order to be sure that for *any* estimate, one has a correct estimation of the real parameter. Among two unbiased estimators $\hat{\delta_1}$ and $\hat{\delta_2}$, we therefore say that $\hat{\delta_1}$ is **more efficient** than $\hat{\delta_2}$ if 

\begin{equation} 
Var(\hat{\delta}_1) \leq Var(\hat{\delta}_2)
(\#eq:EFFICIENCY)
\end{equation} 

Where $Var(\hat{\delta})$ is the variance of the sampling distribution of the estimator $\hat{\delta}$. Among all unbiased estimators, the more efficient will be the one with the smallest variance \footnote{The famous Cramer-Rao inequality provides a theoretical lower bound for the variance of unbiased estimators. An estimator reaching this bound is therefore most efficient.}. Again, the variance of an estimator $\hat{\delta}$ is a function of its size (the larger the estimator, the larger the variance) and therefore, we might be interested in reducing the effect size impact in computing the *relative variance* as the ratio between the variance and the square of the population estimator:

\begin{equation} 
\hat{\delta}_{relative \; variance}=\frac{Var(\hat{\delta})}{\delta^2}
(\#eq:RELVAR)
\end{equation} 

Note that both unbiasedness and efficiency are very important. An unbiased estimator with such a large variance that somes estimates are extremely far from the real parameter is as undesirable as a parameter which is highly biased. In some situations, it is better to have a slightly biased estimator with a tight shape around the biased value (so that each estimate remains relatively close to the true parameter and one can apply bias correction techniques) rather than an unbiased estimator with a large variance [@Raviv]. 

Finally, the last property of a good point estimator is **consistency**: consistency means that the bigger the sample size, the closer the estimate is to the population parameter. In other words, the estimates *converge* to the true population parameter. 

Beyond the inferential properties, @Cumming_2013 reminds that an effect size estimator needs to have a constant value across designs in order to be easily interpretable and to be included in meta-analysis. In other words, it should achieve the property of **generality**.

# Confidence interval around a point estimator

We already mentioned that confidence interval around a point estimate could replace conventional hypothesis testing. A confidence interval contains all the information that a $p$-value of a test based on the same estimator does: if the area of the null hypothesis is out of the $(1-\alpha)$-confidence interval, then the hypothesis test would also result in a *p*-value below the nominal alpha level. Hypothesis tests and confidence intervals based on the same statistical quantity (this is an essential requirement) are thus directly related. At the same time, the intervals provide extra information about the precision of the sample estimate for inferential purposes, and therefore on how confident we can be in the observed results [@Ellis_2015; @Altman_2005]: the narrower the interval, the higher the precision. On the other hand, the wider the confidence interval, the more the data lacks precision (for example, because the sample size is too small).

# Different measures of effect sizes

The *d*-family effect sizes are commonly used with “between-subject” designs where individuals are randomly assigned into one of two independent groups and groups scores means are compared. The population effect size is defined as 
  
\begin{equation} 
\delta = \frac{\mu_{1}-\mu_{2}}{\sigma} 
(\#eq:Cohendelta)
\end{equation} 

where both populations follow a normal distribution with mean $\mu_j$ in the $j^{th}$ population (j=1,2) and common standard deviation $\sigma$. They exist different estimators of this effect size measure. For all of them, the mean difference is estimated by the difference $\bar{X}_1-\bar{X}_2$ of both sample means. When the equality of variances assumption is assumed, $\sigma$ is estimated by pooling both samples standard deviations ($S_1$ and $S_2$). When the equality of variances assumption cannot be assumed, alternatives to the common standard deviation are available. Throughout this section, we will present some of these estimators, separately depending on whether they rely on the assumption of equality of variances or not. For each of them, we will provide information about their theoretical bias, variance and consistency.

## When variances are equal between groups

When we have good reasons to assume equality of variances between groups, then the most common  estimator of $\delta$ is Cohen's $d_{s}$ where the sample mean difference is divided by a pooled error term [@Cohen_1965]: 
\begin{equation} 
Cohen's \; d_s = \frac{\bar{X}_1-\bar{X}_2}{\sqrt{\frac{(n_1-1) \times S_1^2+(n_2-1) \times S_2^2}{n_1+n_2-2}}}
(\#eq:Cohends)
\end{equation} 

Where $S_j$ is the standard deviation and $n_j$ the sample size of the $j^{th}$ sample (j=1,2). The reasoning behind this measure is to make use of the fact that both samples share the same population variance [@Keselman_et_al_2008], hence we achieve a more accurate estimation of the population variance by pooling both estimates of this parameter (i.e $S_1$ and $S_2$). Since the larger the sample size, the more accurate the estimate, we give more weight to the estimate based on the larger sample size. Cohen's $d_{s}$ is directly related with Student's *t*-statistic: 

\begin{equation} 
cohen's \; d_s =  t_{student} \times \sqrt{\frac{n_1+n_2}{n_1n_2}}
(\#eq:Cohenvsstudent)
\end{equation} 

Under the assumption of normality and equal variances between groups, Student's *t*-statistic follows a *t*-distribution with known degrees of freedom and noncentrality parameter \footnote{Under the null hypothesis of no differences between sample means, Student's $t$-statistic will follow a central $t$-distribution with $n_1+n_2-2$ degrees of freedom. However, when the null hypothesis is false, the distribution of this quantity will not be centered, and noncentral $t$-distribution will arise.}: 

\begin{equation} 
df_{student} = n_1+n_2-2
(\#eq:studentdf)
\end{equation} 

\begin{equation} 
ncp_{student} = \frac{\mu_1-\mu_2}{\sigma_{pooled}} \times \sqrt{\frac{n_1n_2}{n_1+n_2}}, \;\;\; where \; \sigma_{pooled}= \sqrt{\frac{(n_1-1) \times \sigma^2_1+(n_2-1) \times \sigma^2_2}{n_1+n_2-2}}
(\#eq:studentncp)
\end{equation} 

The relationship described in equation \ref{eq:Cohenvsstudent} and the theoretical distribution of Student's *t*-statistic allow us to theoretically determine the sampling distribution of Cohen's $d_s$, and therefore, its theoretical expectancy and variance when the assumptions of normality and equal variances are met. All these equations are provided in Table 1. For interested readers, bias and variance of Cohen's $d_s$ have been thoroughly studied, based on Table 1, so as to determine the way different parameters influence them, and results are detailed and available on Github (see Supplemental Material 1 in  https://github.com/mdelacre/Effect-sizes/; it will be the same for all estimators described later). 

While Cohen's $d_s$ is a consistent estimator, its bias and variance are substantial with small sample sizes, even under the assumptions of normality and equal variances [@Lakens_2013]. In order to compensate for Cohen's $d_s$ bias with small sample sizes, @Hedges_Olkin_1985 has defined a bias-corrected version: 

\begin{equation} 
Hedges' \; g_s = Cohen's \; d_s \times \frac{\Gamma(\frac{df_{Student}}{2})}{\sqrt{\frac{df_{Student}}{2}} \times \Gamma(\frac{df_{Student}-1}{2})}
(\#eq:Hedgesgs)
\end{equation} 

Where $df_{Student}$ has been defined in equation \ref{eq:studentdf},and $\Gamma()$ is the gamma function. This equation can be approximated as follows: 

\begin{equation} 
Hedges' \; g_s = Cohen's \; d_s \times \left( 1- \frac{3}{4N -9} \right)
(\#eq:Hedgesgsapprox)
\end{equation} 

Hedges' $g_s$ is theoretically unbiased when the assumptions of normality and equal variances are met (see Table 1), and it has a smaller variance than Cohen's $d_s$, especially with small sample sizes \footnote{$.52 \le \left[\frac{\Gamma(\frac{df}{2})}{\sqrt{\frac{df}{2}} \times \Gamma(\frac{df-1}{2})} \right] ^2 < 1$ for $3 \le df < \infty$. The larger the total sample size, the smaller the difference between the variance of Cohen's $d_s$ and Hedges' $g_s$.}. As Cohen's $d_s$, its variance depends on the total sample size (N), the sample sizes ratio $\left( \frac{n_1}{n_2}\right)$ and the population effect size ($\delta_{Cohen}$). How these parameters influence the variance of Hedges' $g_s$ will be summarized in a later section in which we will compare different estimators through Monte Carlo simulations (see the section "Monte Carlo Simulations").

While the pooled error term is the best choice when variances are equal between groups  [@Grissom_Kim_2001], it may not be well advised for use with data that violate this assumption [@Kelley_2005;@Grissom_Kim_2001; @Cumming_2013; @Grissom_and_kim_2005; @Kelley_2005; @Shieh_2013]. When variances are unequal between groups, the expression in equation \ref{eq:Cohendelta} is no longer valid because both groups don't share a common population variance. If we pool the estimates of two unequal population variances, the estimator of effect size will be lower as it should be in case of positive pairing (i.e. the group with the larger sample size is extracted from the population with the larger variance) and larger as it should be in case of negative pairing (i.e. the group with the larger sample size is extracted from the population with the smaller variance). Because the assumption of equal variances across populations is very rare in practice [@Glass_et_al_1972; @Cain_et_al_2017; @Micceri_1989; @Yuan_et_al_2004; @Erceg-Hurn_Mirosevich_2008;@Grissom_2000; @Delacre_et_al_2017; @Delacre_et_al_2019], both Cohen's $d_s$ and Hedges' $g_s$ should be abandoned in favor of an alternative robust to unequal population variances.

\newpage
\blandscape

| |  df   |      Expectancy    |               Variance                     |
|-----------| :--------:  |:---------------------:  | :--------------------------------------:  |
| $Cohen's \; d_s$    |     $N-2$| $\delta_{cohen} \times \frac{\sqrt{\frac{df}{2}} \times \Gamma(\frac{df-1}{2})}{\Gamma(\frac{df}{2})}$  |$\frac{N\times df}{n_1n_2 \times (df-2)} + \delta^2_{Cohen} \left[ \frac{df}{df-2} - \left( \frac{\sqrt{\frac{df}{2}} \times \Gamma \left(\frac{df-1}{2} \right)}{\Gamma \left( \frac{df}{2}\right)}\right)^2\right]$ |
|    |      |  |    |
|    | |$\approx \frac{\delta_{Cohen}}{\left(1-\frac{3}{4N-9}\right)}$|$\approx \frac{N\times df}{n_1n_2 \times (df-2)} + \delta^2_{Cohen} \left[ \frac{df}{df-2} - \left( \frac{1}{1-\frac{3}{4N-9} }\right)^2\right]$    |
|    |      |  |    |
|    |      |  |    |
| $Hedges's \; g_s$   |$N-2$ | $\delta_{Cohen}$       |$Var(Cohen's \; d_s) \times \left[ \frac{\Gamma(\frac{df}{2})}{\sqrt{\frac{df}{2}} \times \Gamma(\frac{df-1}{2})} \right]^2$   |
|    |      |  |    |
|     |       |  |$\approx Var(Cohen's \; d_s) \times \left[1-\frac{3}{4N-9}\right]^2$   |
|    |      |  |    |

Table: Expentency, bias and variance of Cohen's $d_s$ and Hedges' $g_s$ under the assumptions that independent residuals are normally distributed with equal variances across groups.  

*Note*. Cohen's $d_s$ is a biased estimator, because its expectation differ from the population effect size. On the other hand, Hedges' $g_s$ is an unbiased estimator, because its expectation equals the population effect size; equations in Table 1 require $df \ge 3$ (i.e. $N \ge 5$).

\elandscape

## When variances are unequal between populations

In his review, @Shieh_2013 mentions three options available in the literature to deal with the case of unequal variances: the sample mean difference divided by (A) the Glass's $d_s$, (B)  the Shieh's $d_s$ and (C) the non pooled average of both variance estimates. 

### Glass's $d_s$
When comparing one control group with one experimental group, @Glass_et_al_1981 recommend using the standard deviation $SD$ of the control group as standardizer. It is also advocated by @Cumming_2013, because, according to him, it is what makes the most sense, conceptually speaking. This yields

\begin{equation} 
Glass's \; d_s = \frac{\bar{X}_{e} - \bar{X}_{c}}{S_{c}}
(\#eq:Glassds)
\end{equation} 

Where $\bar{X}_{e} \; and \; \bar{X}_{c}$ are respectively the sample means of the experimental and control groups, and $S_{c}$ is the sample SD of the control group. One argument in favour of using the $SD$ of the control group as standardizer is the fact that it is not affected by the experimental treatment. When it is easy to identify which group is the "control" one, it is therefore convenient to compare the effect size estimation of different designs studying the same effect. However, defining this group is not always obvious [@Coe_2002]. This could induce large ambiguity because depending of the chosen $SD$ as standardizer, measures could be substantially diﬀerent [@Shieh_2013]. 

The distribution of Glass's $d_{s}$ is defined as following [@Algina_et_al_2006]:

\begin{equation} 
Glass's \; d_s \sim \sqrt{\frac{1}{n_{c}}+\frac{S_{e}^2}{n_{e} \times S^2_{c}}} \times t_{df,ncp}
(\#eq:glassvst)
\end{equation} 

Where $n_c$ and $n_e$ are respectively the sample sizes of the control and experimental groups, and $df$ and $ncp$ are defined as follows:

\begin{equation} 
df = n_{c}-1
(\#eq:glassdf)
\end{equation} 

\begin{equation} 
ncp = \frac{\mu_{c}-\mu_{e}}{\sigma_{c} \times \sqrt{\frac{1}{n_{c}} + \frac{\sigma_{e}^2}{n_{e} \times \sigma^2_{c}}}}
(\#eq:glassdf)
\end{equation} 

Where $\mu_c$ and $\mu_e$ are respectively the mean of the populations control and experimental groups are extracted from. Thanks to equation \ref{eq:glassvst}, we can compute its theoretical expectancy variance when the assumptions of normality is met (See Table 2), and therefore determine which factors influence bias and variance, and how they do so (see Supplemental Material 1). 

\newpage
\blandscape
                                             
| | df|      Expectancy    |               Variance                     |
|:-----------|:-------------------:|:-----------------:  | :----------------------------------------------------:| 
| $Glass's \; d_s$    |$n_c-1$|\ $\delta_{glass} \times c_f$  |   $\frac{df}{df-2} \times \left( \frac{1}{n_c} + \frac{\sigma^2_e}{n_e\sigma^2_c}\right) + \delta^2_{Glass} \left( \frac{df}{df-2} - c_f^2 \right)$ |     |
|    |      |  |    |
| $Cohen's \; d'_s$    |$\frac{(n_1-1)(n_2-1)(s^2_1+s^2_2)^2}{(n_2-1)s^4_1+(n_1-1)s^4_2}$|  $\delta'_{Cohen} \times c_f$       |$\frac{df}{df-2} \times \frac{2\left( \frac{\sigma^2_1}{n_1} + \frac{\sigma^2_2}{n_2} \right)}{\sigma^2_1+\sigma^2_2} + (\delta'_{Cohen})^2 \left( \frac{df}{df-2} - c_f^2 \right)$ |     |
  |    |      |  |    ||
  |     || $\approx \delta'_{Cohen} \times \frac{4df-1}{4(df-1)}$  |  $\approx \frac{df}{df-2} \times \frac{2\left( \frac{\sigma^2_1}{n_1} + \frac{\sigma^2_2}{n_2} \right)}{\sigma^2_1+\sigma^2_2} + (\delta'_{Cohen})^2 \left[ \frac{df}{df-2} - \left( \frac{4 \;df-1}{4(df-1)}\right)^2 \right]$              |
|    |      |  |    |
  |  $Shieh's \; d_s$  |$\approx \frac{\left(\frac{\sigma^2_1}{n_1}+\frac{\sigma^2_2}{n_2} \right)^2}{\frac{(\sigma^2_1/n_1)^2}{n_1-1}+\frac{(\sigma^2_2/n_2)^2}{n_2-1}}$|$\delta_{Shieh} \times c_f$|$\frac{df}{(df-2)N}  + \delta^2_{Shieh} \left( \frac{df}{df-2} - c_f^2 \right)$    |
|    |      |  |    |
Table: Expentency, bias and variance of Glass's $d_s$ and Cohen's $d'_s$ and Shieh's $d_s$ under the assumptions that independent residuals are normally distributed.

*Note*. $c_f=\frac{\sqrt{\frac{df}{2}} \times \Gamma\left( \frac{df-1}{2}\right)}{\Gamma\left( \frac{df}{2}\right)}$; all estimators are biased estimators, because their expectations differ from the population effect size $\delta$; equations require $df \ge 3$ and at least 2 subjects per group. 

\elandscape
\newpage

### Shieh's $d_s$
@Kulinskaya_Staudte_2007 were the first to advice the use of a standardizer that takes the sample sizes allocation ratios into account, in addition to the variance of both samples. @Shieh_2013, following @Kulinskaya_Staudte_2007,  proposed a modification of the exact *SD* of the sample mean difference: 
      
\begin{equation} 
Shieh's \; d_s = \frac{\bar{X}_1 - \bar{X}_2}{\sqrt{S_1^2/q_1+S_2^2/q_2}}; \;\;\; q_j=\frac{n_j}{N} (j=1,2)
(\#eq:Shiehds)
\end{equation} 

where $N = n_1+n_2$. Shieh's $d_{s}$ is directly related with Welch's *t*-statistic:

\begin{equation} 
t_{welch} = Shieh's \; d_s \times \sqrt{N}
(\#eq:shiehvswelch)
\end{equation} 

Where $N = n_1+n_2$. The exact distribution of Welch's *t*-statistic is more complicated than the exact distribution of Student's *t*-statistic, but it follows a *t*-distribution with degrees of freedom and noncentrality parameters that can be approximated as follows, under the assumption of normality [@Welch_1938; @Shieh_2013]:

\begin{equation} 
df_{Welch} \approx \frac{\left(\frac{\sigma^2_1}{n_1}+\frac{\sigma^2_2}{n_2} \right)^2}{\frac{(\sigma^2_1/n_1)^2}{n_1-1}+\frac{(\sigma^2_2/n_2)^2}{n_2-1}}
(\#eq:welchdf)
\end{equation} 

\begin{equation} 
ncp_{Welch} = \frac{\mu_1-\mu_2}{\sqrt{\frac{\sigma_1^2}{n_1/N}+\frac{\sigma_2^2}{n_2/N}}} \times \sqrt{N}
(\#eq:welchncp)
\end{equation} 

The relationship described in equation \ref{eq:shiehvswelch} and the theoretical distribution of Welch's *t*-statistic allow us to theoretically approximate the sampling distribution of Shieh's $d_s$. Based on the sampling distribution of Shieh's $d_s$, we can estimate its theoretical expectancy and variance under the assumption of normality (see Table 2), and therefore and therefore determine which factors influence bias and variance, and how they do so (see Supplemental Material 1).

It can be demonstrated that when variances and sample sizes are equal across groups, the biases and variances of Shieh's $d_s$ and Cohen's $d_s$ are identical except for a constant, as shown in equations \ref{eq:biascohenshieh} and \ref{eq:varcohenshieh}:

\begin{equation} 
Shieh's \; d_{s,bias} = 2 \times Cohen's \; d_{s,bias} \;\;\;(considering \; \sigma_1 = \sigma_2 \; and \; n_1 = n_2)
(\#eq:biascohenshieh)
\end{equation} 

\begin{equation} 
Shieh's \; d_{s,variance} = 4 \times Cohen's \; d_{s,variance} \;\;\;(considering \; \sigma_1 = \sigma_2 \; and \; n_1 = n_2)
(\#eq:varcohenshieh)
\end{equation} 

Due to the relation described in equation \ref{eq:cohenshieh} when sample sizes are equal between groups (as explained in Supplemental Material 2), such proportions mean that relative to their respective true effect size, Cohen's $d_s$ and Shieh's $d_s$ are equally good. This is a good illustration of the fact that biases and variances should always be studied relative to the population effect size (and not in absolute terms), as we will do later. 

\begin{equation} 
Shieh's \; \delta_{n_1=n_2}= \frac{Cohen's \; \delta_{n_1=n_2}}{2}
(\#eq:cohenshieh)
\end{equation} 

Except for this very specific situation, according to the statistical properties of Welch’s statistic under heteroscedasticity, Shieh's $d_s$ accounts for the sample sizes allocation ratio. The lack of generality caused by taking this specificity of the design into account has led @Cumming_2013 to question its usefulness in terms of interpretability: when keeping constant the mean difference ($\bar{X_1}-\bar{X_2}$) as well as $SD_1$ and $SD_2$, Shieh's $d_s$ will vary as a function of the sample sizes allocation ratio (the dependency of Shieh's $d_s$ value on the sample sizes allocation ratio is illustrated in the following shiny application:  https://mdelacre.shinyapps.io/ShiehvsCohen/).

### Cohen's $d'_s$
The sample mean difference, divided by the non pooled average of both variance estimates was suggested by @Welch_1938. This yields:

\begin{equation} 
Cohen's \; d'_s = \frac{\bar{X}_{1} - \bar{X}_{2}}{ \sqrt{\frac{\left(S^2_{1}+S^2_{2} \right)}{2}}}
(\#eq:cohenprimeds)
\end{equation} 

Where $\bar{X}_{j}$ is the mean and $S_j$ is the standard deviation of the $j^{th}$ sample (j = 1,2). We know the distribution of Cohen's $d'_{s}$ [@Huynh_1989]: 

\begin{equation} 
cohen's \; d'_s \sim  \sqrt{\frac{\left( \frac{\sigma^2_1}{n_1}+\frac{\sigma^2_2}{n_2}\right)(\sigma^2_1+\sigma^2_2)}{2}} \times t_{df^*,ncp^*}
(\#eq:cohendprimedist)
\end{equation} 

Where $df^*$ and $ncp^*$ are defined as follows:

\begin{equation} 
df^* = \frac{(n_1-1)(n_2-1)(s^2_1+s^2_2)^2}{(n_2-1)s^4_1+(n_1-1)s^4_2}
(\#eq:cohendprimedf)
\end{equation} 

\begin{equation} 
ncp^*=\frac{\mu_1-\mu_2}{\sqrt{\frac{\sigma^2_1+\sigma^2_2}{2}}} \times \sqrt{\frac{n_1n_2(\sigma^2_1+\sigma^2_2)}{2(n_2\sigma^2_1+n_1\sigma^2_2)}}
(\#eq:cohendprimevst)
\end{equation} 

Thanks to equation \ref{eq:cohendprimevst}, we can compute its theoretical expectancy variance when the assumptions of normality is met (See Table 2), and therefore determine which factors influence bias and variance, and how they do so (see Supplemental Material 1). This estimator has been widely criticized, because:  
- it results in a variance term of an artificial population and is therefore very difficult to interpret [@Grissom_Kim_2001];    
- unless both sample sizes are equal, the variance term does not correspond to the variance of the mean difference [@Shieh_2013].     

However, we will show throughout the simulation section that this estimator show very good inferential properties.

### Glass's $g_s$,  Shieh's $g_s$ and Hedges' $g'_s$

As for Cohen's $d_s$, an Hedges' correction can be applied in order to compensate for the bias of Glass's $d_s$, Shieh's $d_s$ and  Cohen's $d'_s$ with small sample sizes (see Table 2). This correction has the following general form:

\begin{equation} 
g_s = d_s \times \frac{\Gamma(\frac{\nu}{2})}{\sqrt{\frac{\nu}{2}} \times \Gamma(\frac{\nu-1}{2})}
(\#eq:Hedgesgs)
\end{equation} 

Where $\nu$ are provided in equation \ref{eq:glassdf} for Glass's $g_s$, in equation \ref{eq:cohendprimedf} for Hedges' $g'_s$ and in equation \ref{eq:welchdf} for Shieh's $g_s$. The three corrected estimators are theoretically unbiased when the assumptions of normality is met. Their variance are a function of the same factors as their biased equivalent, however, due to the correction, they have a smaller variance, especially with small sample size, as shown in Table 3. In summary:  

* The variances of Hedges' $g'_s$ and Shieh's $g_s$ depend on the total sample size ($N$), their respective population effect size ($\delta$), and the interaction between the sample sizes ratio and the $SD$-ratio $\left(\frac{n_1}{n_2}\times\frac{\sigma_1}{\sigma_2} \right)$.  
* The variance of Glass's $g_s$ also depends on $N$, $\delta$ and $\frac{n_1}{n_2}\times\frac{\sigma_1}{\sigma_2}$. In addition, there is also a main effect of the $SD$-ratio $\left(\frac{\sigma_1}{\sigma_2} \right)$ on its variance.  

How these parameters influence the variance of the estimators will be summarized and illustrated in the section dedicated to the Monte Carlo simulations.

\newpage
\blandscape

                                             
| | df|      Expectancy    |               Variance                     |
|:-----------|:-------------------:|:-----------------:  | :----------------------------------------------------:| 
| $Glass's \; g_s$    |$n_c-1$|\ $\delta_{glass}$  |   $Var(Glass's \; d_s) \times \left( \frac{\Gamma\left(\frac{df}{2} \right)}{\sqrt{\frac{df}{2}} \times \Gamma \left( \frac{df-1}{2}\right)}\right)^2$ |
|    |      |  |    |
| $Cohen's \; g'_s$    |$\frac{(n_1-1)(n_2-1)(s^2_1+s^2_2)^2}{(n_2-1)s^4_1+(n_1-1)s^4_2}$|  $\delta'_{Cohen}$       |$Var(Cohen's \; d'_s) \times \left( \frac{\Gamma\left(\frac{df}{2} \right)}{\sqrt{\frac{df}{2}} \times \Gamma \left( \frac{df-1}{2}\right)}\right)^2$ |     |
  |    |      |  |    ||
  |  $Shieh's \; g_s$  |$\approx \frac{\left(\frac{\sigma^2_1}{n_1}+\frac{\sigma^2_2}{n_2} \right)^2}{\frac{(\sigma^2_1/n_1)^2}{n_1-1}+\frac{(\sigma^2_2/n_2)^2}{n_2-1}}$|$\delta_{Shieh}$|$Var(Shieh's \; d_s) \times \left( \frac{\Gamma\left(\frac{df}{2} \right)}{\sqrt{\frac{df}{2}} \times \Gamma \left( \frac{df-1}{2}\right)}\right)^2$    |
|    |      |  |    |
Table: Expentency, bias and variance of Glass's $d_s$ and Cohen's $d'_s$ and Shieh's $d_s$ under the assumptions that independent residuals are normally distributed.

*Note*. $c_f=\frac{\sqrt{\frac{df}{2}} \times \Gamma\left( \frac{df-1}{2}\right)}{\Gamma\left( \frac{df}{2}\right)}$; all estimators are unbiased estimators, because their expectations equal the population effect size $\delta$; equations require $df \ge 3$ and at least 2 subjects per group. 

\elandscape
\newpage

## Monte Carlo Simulations: assessing the bias, efficiency and consistency of 5 estimators

#### Method

We performed Monte Carlo simulations using R (version 3.5.0) to assess the bias, efficiency and consistency of Cohen's $g_s$, Glass's $g_s$ (using respectively the sample $SD$ of the first or second group as a standardizer), Hedges' $g'_s$ and Shieh's $g_s$. 

A set of 100,000 datasets were generated for 1,008 scenarios as a function of different criterions that will be explained below. In 252 scenarios, samples were extracted from a normally distributed population (in order to insure the reliability of our calculation method) and in 756 scenarios, samples were extracted from non normal population distributions. In order to assess the quality of estimators under realistic deviations from the normality assumption, we referred to the review of @Cain_et_al_2017. Cain et al. (2017) investigated 1,567 univariate distributions from 194 studies published by authors in Psychological Science (from January 2013 to June 2014) and the American Education Research Journal (from January 2010 to June 2014). For each distribution, they computed the Fisher's skewness (G1) and kurtosis (G2):
\begin{equation} 
G_{1}=\frac{\sqrt{n(n-1)}}{n-2} \frac{m_{3}}{\sqrt{(m_{2})^3}}
(\#eq:skew)
\end{equation} 

with s = standard deviation, n = sample size,  $m_{2}$ = second centered moment and $m_{3}$ = third centered moment.

\begin{equation} 
G_{2}=\frac{n-1}{(n-2)(n-3)}\times [(n+1)(\frac{m_{4}}{(m_{2})^2}-3)+6]
(\#eq:kurt)
\end{equation} 

with s = standard deviation, n = sample size and $m_{3}$=third centered moment. They found values of kurtosis from G2 = -2.20 to 1,093.48. According to their suggestions, throughout our simulations, we kept constant the population kurtosis value at the 99th percentile of their distribution of kurtosis, i.e. G2=95.75. Regarding skewness, we simulated population parameter values which correspond to the 1st and 99th percentile of their distribution of skewness, i.e. respectively G1 = -2.08 and G1 = 6.32. We also simulated samples extracted from population where G1 = 0, in order to assess the main effect of high kurtosis on the quality of estimators. All possible combinations of population skewness and kurtosis and the number of scenarios for each combination are summarized in Table 4.

\newpage

|                         |               |               | __Kurtosis__ |               
| :---------------------: | :-----------: |:-------------:|:------------:|:-------------:|
|                         |               |     0         |   95.75      |    **TOTAL**    |
|                         |               |---------------|--------------|---------------|
|                         |        0      |     252       |     252      |     **504**     | 
|                         |               |               |              |               |
|      __Skewness__       |      -2.08    |      /        |     252      |     **252**     |
|                         |               |               |              |               |
|                         |      6.32     |        /      |     252      |     **252**     |
|                         |               |               |              |               |
|                         |    **TOTAL**    |    **252**      |    **756**     |    **1008**     |

Table: Number of Combinations of skewness and kurtosis in our simulations.

*Note.* Fisher's skewness (G1) and kurtosis (G2) are presented in Table 4. The 252 combinations where both G1 and G2 equal 0 correspond to the normal case. 

For the 4 resulting combinations of skewness and kurtosis (see Table 4), all other parameter values were chosen in order to illustrate the consequences of factors identified as playing a key role on the variance of unbiased estimators. We manipulated the population mean difference ($\mu_1-\mu_2$), the sample sizes (*n*), the sample size ratio (*n*-ratio = $\frac{n_1}{n_2}$), the population *SD*-ratio (i.e. $\frac{\sigma_1}{\sigma_2}$), and the sample size and population variance pairing $\left(\frac{n_1}{n_2}\times\frac{\sigma_1}{\sigma_2} \right)$. In our scenarios, $\mu_2$ was always 0 and $\mu_1$ varied from 1 to 4, in step of 1 (so does $\mu_1-\mu_2$)\footnote{In the original plan, we had added 252 simulations in which $\mu_1$ and $\mu_2$ were both null. We decided to not present the results of these simulations, because the relative bias and the relative variance appeared to us to be very useful to fully understand the estimators comparison, and computing them is impossible when the real mean difference is zero.}. Moreover, $\sigma_1$ always equals 1, and $\sigma_2$ equals .1, .25, .5, 1, 2, 4 or 10 (so does $\frac{\sigma_1}{\sigma_2}$). The simulations for which both $\sigma_1$ and $\sigma_2$ equal 1 are the particular case of homoscedasticity (i.e. equal population variances across groups). Sample size of both groups ($n_1$ and $n_2$) were 20, 50 or 100. When sample sizes of both groups are equal, the *n*-ratio equals 1 (it is known as a balanced design). All possible combinations of *n*-ratio and population *SD*-ratio were performed in order to distinguish scenarios where both sample sizes and population variances are unequal across groups (with positive pairing when the group with the largest sample size is extracted from the population with the largest *SD*, and negative pairing when the group with the smallest sample size is extracted from the population with the smallest *SD*) and scenarios with no pairing between sample sizes and variances (sample sizes and/or population *SD* are equal across all groups). In sum, the simulations grouped over different sample sizes yield 4 conditions based on the *n*-ratio, population *SD*-ratio, and sample size and population variance pairing, as summarized in Table 5.  

|                               |             |             |__*n*-ratio__|             |
| :---------------------------: | :---------: |:----------: |:-----------:|:-----------:|
|                               |             |    **1**    |    **>1**   |    **<1**   |
|                               |             |------------ |-------------|-------------|
|                               |    **1**    |      a      |      b      |      b      | 
|                               |             |             |             |             |
|      __*SD*-ratio__           |   **>1**    |      c      |      d      |      d      |
|                               |             |             |             |             |
|                               |   **<1**    |      c      |      d      |      d      |

Table: 4 conditions based on the n-ratio, SD-ratio, and sample size and variance pairing.

*Note.* The *n*-ratio is the sample size of the first group ($n_1$) divided by the sample size of the second group ($n_2$). When all sample sizes are equal across groups, the *n*-ratio equals 1. When $n_1 > n_2$, *n*-ratio > 1, and when $n_1 < n_2$, *n*-ratio < 1. *SD*-ratio is the population *SD* of the first group ($\sigma_1$) divided by the population *SD* of the second group ($\sigma_2$). When $\sigma_1=\sigma_2$, *SD*-ratio = 1. When $\sigma_1>\sigma_2$, *SD*-ratio > 1. Finally, when $\sigma_1<\sigma_2$, *SD*-ratio < 1.

#### Results

Before detailing estimators comparison for each condition, it might be interesting to make some general comments. 

1) We previously introduced the fact that raw bias and variances are sometimes misleading.  They can give the illusion of huge differences between two estimators, even if these differences only reflect a change of unit (i.e. different population effect sizes). To better understand this, imagine a sample of 15 people for whom we know the height (in meters) and we compute a sample variance of 0.06838. If we convert sizes to centimeters and compute the sample variance again, we find a measure of 683.8 (i.e. $10^3$ larger). Both measures represent the same amount of variability, but they are expressed in different units. Similar things occur when comparing the estimates of different population measures. To avoid this possible confusion, we will only present the relative bias and relative variance in all Figures (and anytime we will mention the biases and variances in the results section, we will be referring to relative bias and variance). For interested reader, illustrations of the raw bias and variance are available on Github.

2) In a purpose of readability, we used different scales for the ordinate axis of our plots that compare the relative bias of all estimators when $G_1 = 6.32$ and $G_2 = 95.75$, in comparisons with all other conditions. Indeed, relative biases are much larger for this specific combination $G_1/G_2$. In the same way of thinking, we also used different scales for the ordinate axis of our plots that compare the relative variance of all estimators, as a function of the condition.  

3) Throughout this section, we will **compare** the quality of different estimators. We chose very extreme (although realistic) conditions, and we know that none of the parametric measures of effect size will be robust against such extreme conditions. Our goal is therefore to study the robustness of the estimators against normality violations only in comparison with the robustness of other indicators, but not in absolute terms. 

After these general remarks, we will analyze each condition separately. In all Figures presented below, for different sub-conditions, the averaged relative bias and relative variance of five estimators are presented. When describing the Glass's $g_s$ estimators, we will systematically call "control group" the group the standardizer is computed from (i.e. the first group when using $SD_1$ as standardizer, the second group when using $SD_2$ as standardizer). The other group will be called "experimental group".

##### When variances are equal across groups

```{r "ESgoodnessoutputs",echo=FALSE}

# G1=0; G2=0
output_normal <- read.table("C:/Users/Marie/Documents/Github_projects/Effect-sizes/Scripts outputs/Quality of ES measures/Data summary/Unbiased estimators/G1=0,G2=0_unbiasedest_properties.txt",sep=";",dec=",")
# Remove all "Inf" and "-Inf" in the output
output_normal[output_normal=="-Inf"|output_normal=="Inf"]=NA # max(output_normal$relbias_Hedge,na.rm=TRUE)

# G1=0; G2 = 95.75
output_heavytails <- read.table("C:/Users/Marie/Documents/Github_projects/Effect-sizes/Scripts outputs/Quality of ES measures/Data summary/Unbiased estimators/G1=0,G2=95.75_unbiasedest_properties.txt",sep=";",dec=",")
output_heavytails[output_heavytails=="-Inf"|output_heavytails=="Inf"]=NA # max(output_heavytails$relbias_Hedge,na.rm=TRUE)

# G1=-2.08; G2 = 95.75
output_leftskewed <- read.table("C:/Users/Marie/Documents/Github_projects/Effect-sizes/Scripts outputs/Quality of ES measures/Data summary/Unbiased estimators/G1=2.08,G2=95.75_unbiasedest_properties.txt",sep=";",dec=",")
output_leftskewed[output_leftskewed=="-Inf"|output_leftskewed=="Inf"]=NA # max(output_leftskewed$relbias_Hedge,na.rm=TRUE)

# G1=6.32; G2 = 95.75
output_rightskewed <- read.table("C:/Users/Marie/Documents/Github_projects/Effect-sizes/Scripts outputs/Quality of ES measures/Data summary/Unbiased estimators/G1=6.32,G2=95.75_unbiasedest_properties.txt",sep=";",dec=",")
output_rightskewed[output_rightskewed=="-Inf"|output_rightskewed=="Inf"]=NA # max(output_rightskewed$relbias_Hedge,na.rm=TRUE)

#---------------------------------------------------------------------------------------------------------------------------

# Select only rows from a specific condition

idcondition=function(File){
id_Hom_bal=as.numeric(rownames(File[(File$m1.m2!=0)&(File$n1==File$n2)&(File$sd1.sd2 == 1),]))
# Homoscedasticity, unbalanced designs ("Hom_unbal")  
id_Hom_nN=as.numeric(rownames(File[(File$m1.m2!=0)&(File$n1<File$n2)&(File$sd1.sd2 == 1),]))
id_Hom_Nn=as.numeric(rownames(File[(File$m1.m2!=0)&(File$n1>File$n2)&(File$sd1.sd2 == 1),]))
# Heteroscedasticity, balanced designs ("Het_bal")
id_sdSD_bal=as.numeric(rownames(File[(File$m1.m2!=0)&(File$n1==File$n2)&(File$sd1.sd2 < 1),]))
id_SDsd_bal=as.numeric(rownames(File[(File$m1.m2!=0)&(File$n1==File$n2)&(File$sd1.sd2 > 1),]))
# Heteroscedasticity, positive correlation between n and sd ("Het_unbal")
id_sdSD_nN=as.numeric(rownames(File[(File$m1.m2!=0)&(File$n1<File$n2)&(File$sd1.sd2 < 1),]))
id_SDsd_Nn=as.numeric(rownames(File[(File$m1.m2!=0)&(File$n1>File$n2)&(File$sd1.sd2 > 1),]))
id_SDsd_nN=as.numeric(rownames(File[(File$m1.m2!=0)&(File$n1<File$n2)&(File$sd1.sd2 > 1),]))
id_sdSD_Nn=as.numeric(rownames(File[(File$m1.m2!=0)&(File$n1>File$n2)&(File$sd1.sd2 < 1),]))
  
# Study each condition separately
Conditions_id <- list(id_Hom_bal=id_Hom_bal,
                      id_Hom_unbal=c(id_Hom_nN,id_Hom_Nn),
                      id_Het_bal=c(id_sdSD_bal,id_SDsd_bal), 
                      id_Het_unbal=c(id_sdSD_nN,id_SDsd_Nn,id_SDsd_nN,id_sdSD_Nn))

return(Conditions_id)

}

output_normal_Hombal <- output_normal[idcondition(File=output_normal)$id_Hom_bal,]
output_normal_Homunbal <- output_normal[idcondition(File=output_normal)$id_Hom_unbal,]
output_normal_Hetbal <- output_normal[idcondition(File=output_normal)$id_Het_bal,]
output_normal_Hetunbal <- output_normal[idcondition(File=output_normal)$id_Het_unbal,]

output_heavytails_Hombal <- output_heavytails[idcondition(File=output_heavytails)$id_Hom_bal,]
output_heavytails_Homunbal <- output_heavytails[idcondition(File=output_heavytails)$id_Hom_unbal,]
output_heavytails_Hetbal <- output_heavytails[idcondition(File=output_heavytails)$id_Het_bal,]
output_heavytails_Hetunbal <- output_heavytails[idcondition(File=output_normal)$id_Het_unbal,]

output_leftskewed_Hombal <- output_leftskewed[idcondition(File=output_leftskewed)$id_Hom_bal,]
output_leftskewed_Homunbal <- output_leftskewed[idcondition(File=output_leftskewed)$id_Hom_unbal,]
output_leftskewed_Hetbal <- output_leftskewed[idcondition(File=output_leftskewed)$id_Het_bal,]
output_leftskewed_Hetunbal <- output_leftskewed[idcondition(File=output_normal)$id_Het_unbal,]

output_rightskewed_Hombal <- output_rightskewed[idcondition(File=output_rightskewed)$id_Hom_bal,]
output_rightskewed_Homunbal <- output_rightskewed[idcondition(File=output_rightskewed)$id_Hom_unbal,]
output_rightskewed_Hetbal <- output_rightskewed[idcondition(File=output_rightskewed)$id_Het_bal,]
output_rightskewed_Homunbal <- output_rightskewed[idcondition(File=output_normal)$id_Het_unbal,]
```

```{r "idHombal", fig.env = "sidewaysfigure",echo=FALSE, fig.cap="Bias and efficiency of estimators of standardized mean difference, when variances and sample sizes are equal across groups (condition a)",fig.show='hold',fig.align='center'}
knitr::include_graphics("C:/Users/Marie/Documents/Github_projects/Effect-sizes/Scripts outputs/Quality of ES measures/Graphs/Unbiased estimators/Combined Figures_relative quality/Hom_bal.png")
```

```{r "idHomunbal", fig.env = "sidewaysfigure",echo=FALSE, fig.cap="Bias and efficiency of estimators of standardized mean difference, when variances are equal across groups and sample sizes are unequal (condition b)",fig.show='hold',fig.align='center'}
knitr::include_graphics("C:/Users/Marie/Documents/Github_projects/Effect-sizes/Scripts outputs/Quality of ES measures/Graphs/Unbiased estimators/Combined Figures_relative quality/Hom_unbal.png")
```

Figures \ref{fig:idHombal} and \ref{fig:idHomunbal} represent configurations where the equality of variances assumption is met. According to our expectations, one observes that the bias of all estimators is approximately zero as long as the normality assumption is met (first column in both Figures)\footnote{When looking at the relative bias for all estimators, the maximum departure from zero is `r printnum(max(abs(output_normal_Hombal[,11:15])),digits=4)` when sample sizes are equal across groups, and `r printnum(max(abs(output_normal_Homunbal[,11:15])),digits=4)` with unequal sample sizes.}. However, the further from the normality assumption (i.e. when moving from left to right in Figures), the larger the bias. 

Figure \ref{fig:idHombal} illustrates scenarios where both population variances and sample sizes are equal across groups (condition a). One can first notice that all estimators are consistent, as their bias and variance decrease when the total sample size increase. For any departure from the normality assumption, both bias and variance of Hedges' $g_s$, Shieh's $d_s$ and Hedges' $g'_s$ are similar\footnote{While the bias and variance of Cohen's $d_s$, Cohen's $d'_s$ and Shieh's $d_s$ are identical, the bias and variance of Hedges' $g_s$ is marginally different than the bias and variance of Hedges' $g'_s$ and Shieh's $g_s$ (these last two having identical bias and variance). Indeed, because of the sampling error, differences remain between sample variances, even when population variances are equal groups. Because the Hedges' correction applied to Cohen's $d_s$ does not imply the sample variances (unlike the one applied on both other estimators), the bias and variance of Hedges' $g_s$ is slighly different than the bias and variance of Hedges' $g'_s$ and Shieh's $g_s$} and smaller than the bias and variance of glass's $g_s$ estimates using either $S_1$ or $S_2$ as standardizer. Moreover, when samples are extracted from skewed distributions, Glass's $g_s$ will show different bias and variance as a function of the chosen standardizer ($S_1$ or $S_2$), even if both $S_1$ and $S_2$ are estimates of the same population variance, based on the same sample size. This is due to non-null correlations of opposite sign between the mean difference ($\bar{X_1}-\bar{X_2}$) and respectively $S_1$ and $S_2$. For interested reader, when a non nul correlation occurs between the sample means difference ($\bar{X_1}-\bar{X_2}$) and the standardizer of compared estimators as well as the way this correlation impacts the bias and variance of estimators is detailed in Supplemental Material 3. 

Figure \ref{fig:idHomunbal} illustrates scenarios where population variances are equal across groups and sample sizes are unequal (condition b). For any departures from the normality assumptions, Hedges' $g_s$ shows the smallest bias and variance. Hedges' $g_s$ and Hedges' $g'_s$ are consistent estimators (i.e. the larger the sample sizes, the lower the bias and the variance), unlike Shieh's $g_s$ and Glass's $g_s$. The bias of Glass's $g_s$ does not depend either on the size of the experimental group or on the total sample size. The only way to decrease the bias of Glass's $g_s$ is therefore to add subjects in the control group.  On the other hand, the variance of Glass's $g_s$ depends on both sample sizes, but not in an equivalent way: in order to reduce the variance, it is much more efficient to add subjects in the control group and when the size of the experimental group decreases so does the variance, even when the total sample size is increased. Regarding Shieh's $g_s$, for a given sample size ratio,the bias and variance will decrease when sample sizes increase. However, there is a large effect of the sample sizes ratio in order that when the sample sizes ratio moves away from 1 by adding subjects, bias and variance might increase.\footnote{Regarding variance, in Supplemental Material 1, we mentioned that when the population effect size is nul, the larger the total sample size, the lower the variance, whatever the sample sizes ratio is constant or not. We also mentioned that this is no longer true when the population effect size is not zero and in our simulations, the effect size is never zero. The effect size effect is partially visible in Figure \ref{fig:idHomunbal} because we do not entirely remove the effect size effect when we divide the variance by $\delta^2$. This is due to the fact that one term, in the equation of the variance computation, does not depend on the effect size.} On the other side, when the sample sizes ratio moves closer to 1 by adding subjects, the bias will decrease. 

When samples are extracted from skewed distributions and have unequal sizes (i.e. $n_1 \neq n_2$, the two last columns in Figure \ref{fig:idHomunbal}), for a constant total sample size, $Glass's \; g_s$, Shieh's $g_s$ and  Hedges' $g_s$ will show different bias and variance depending on which group is the largest one (e.g. when distributions are right-skewed, the bias and variance of all these estimators when $n_1$ and $n_2$ are respectively 50 and 20 are not the same as their bias and variance when $n_1$ and $n_2$ are respectively 20 and 50). This is due to a non-null correlations of opposite sign between the mean difference ($\bar{X_1}-\bar{X_2}$) and their respective standardizers depending on which group is the largest one, as detailed in Supplemental Material 3. One observes that under these configurations, the bias and variance of Glass's $g_s$ are sometimes a bit smaller and sometimes much larger than the bias and variance of Shieh's $g_s$ and Cohen's $d'_s$. \footnote{We learn from Supplemental Material 3 that when the $\mu_1-\mu_2 >0$ (like in our simulations), all other parameters being equal, an estimator is always less biased and variable when choosing a standardizer that is positively correlated with $\bar{X_1}-\bar{X_2}$. We also learn from Supplemental Material 3 that the smaller $n_c$, the larger the magnitude of correlation between $s_c$ and $\bar{X_1}-\bar{X_2}$. When $cor(S_c,\bar{X_1}-\bar{X_2})$ is positive, the positive effect of increasing the magnitude of the correlation is counterbalanced by the negative effect of reducing $n_c$. On the other hand, when $cor(S_c,\bar{X_1}-\bar{X_2})$ is negative, the negative effect of increasing the magnitude of the correlation is amplified by the negative effect of decreasing $n_c$. This explain why the difference between Glass's $g_s$ and other estimators is larger when Glass's $g_s$ is the least efficient estimator.}

In conclusion, Glass’s $g_s$ should always be avoided when the equality of variance assumption is met. Hedge’s $g_s$, Hedges' $g'_s$ and Shieh’s $g_s$ are equally performant as long as the sample size ratio is close to 1. However, when designs are highly unbalanced, Shieh’s $g_s$ is not consistent anymore. While Hedge’s $g'_s$ is consistent, Hedges’s $g_s$ remains a better estimator. 

##### When variances are unequal across groups

```{r "idHetbal1", fig.env = "sidewaysfigure",echo=FALSE, fig.cap="Bias and efficiency of estimators of standardized mean difference, when variances are unequal across groups and sample sizes are equal (condition c), as a function of $n$-ratio",fig.show='hold',fig.align='center'}
knitr::include_graphics("C:/Users/Marie/Documents/Github_projects/Effect-sizes/Scripts outputs/Quality of ES measures/Graphs/Unbiased estimators/Combined Figures_relative quality/Het_bal_N.png")
```

```{r "idHetbal2", fig.env = "sidewaysfigure",echo=FALSE, fig.cap="Bias and efficiency of estimators of standardized mean difference, when variances are unequal across groups and sample sizes are equal (condition c) as a function of the $SD$-ratio (when $n_1=n_2=100$)",fig.show='hold',fig.align='center'}
knitr::include_graphics("C:/Users/Marie/Documents/Github_projects/Effect-sizes/Scripts outputs/Quality of ES measures/Graphs/Unbiased estimators/Combined Figures_relative quality/Het_bal_sd.png")
```

```{r "idHetunbal1", fig.env = "sidewaysfigure",echo=FALSE, fig.cap="Bias and efficiency of estimators of standardized mean difference, when variances and sample sizes are unequal across groups (condition d), total sample (N) equals 150, and $n_1>n_2$",fig.show='hold',fig.align='center'}
knitr::include_graphics("C:/Users/Marie/Documents/Github_projects/Effect-sizes/Scripts outputs/Quality of ES measures/Graphs/Unbiased estimators/Combined Figures_relative quality/Het_firstlarger_SDR10.png")
```

```{r "idHetunbal2", fig.env = "sidewaysfigure",echo=FALSE, fig.cap="Bias and efficiency of estimators of standardized mean difference, when variances and sample sizes are unequal across groups (condition d), total sample (N) equals 150, and $n_1<n_2$",fig.show='hold',fig.align='center'}
knitr::include_graphics("C:/Users/Marie/Documents/Github_projects/Effect-sizes/Scripts outputs/Quality of ES measures/Graphs/Unbiased estimators/Combined Figures_relative quality/Het_firstsmaller_SDR10.png")
```

```{r "idHetunbal3", fig.env = "sidewaysfigure",echo=FALSE, fig.cap="Bias and efficiency of estimators of standardized mean difference, when variances and sample sizes are unequal across groups (condition d), total sample (N) equals 120, and $n_1>n_2$",fig.show='hold',fig.align='center'}
knitr::include_graphics("C:/Users/Marie/Documents/Github_projects/Effect-sizes/Scripts outputs/Quality of ES measures/Graphs/Unbiased estimators/Combined Figures_relative quality/Het_firstlarger_SDR2.png")
```

```{r "idHetunbal4", fig.env = "sidewaysfigure",echo=FALSE, fig.cap="Bias and efficiency of estimators of standardized mean difference, when variances and sample sizes are unequal across groups (condition d), total sample (N) equals 120, and $n_1<n_2$",fig.show='hold',fig.align='center'}
knitr::include_graphics("C:/Users/Marie/Documents/Github_projects/Effect-sizes/Scripts outputs/Quality of ES measures/Graphs/Unbiased estimators/Combined Figures_relative quality/Het_firstsmaller_SDR2.png")
```

Figures \ref{fig:idHetbal1} to \ref{fig:idHetunbal4} represent configurations where the equality of variances assumption is not met. According to our expectations, one observes that the bias of all estimators is approximately zero as long as the normality assumption is met (first column in the three Figures), and the further from the normality assumption (i.e. when moving from left to right in Figures), the larger the bias\footnote{When looking at the relative bias for all estimators, the maximum departure from zero is `r printnum(max(abs(output_normal_Hetbal[,11:15])),digits=4)` when sample sizes are equal across groups, and `r printnum(max(abs(output_normal_Hetunbal[,11:15])),digits=4)` when both sample sizes and variances differ across groups.}. You might find it surprising that the bias of Hedges' $g_s$ remain very small troughout these conditions. As reminded in the section "Different measures of effect size", Hedges' $g_s$ should be avoided when population variances and sample sizes are unequal across groups, because of the pooled error term. When pooling the estimates of two unequal population variances, the resulting estimator will be lower (in case of positive pairing) or larger (in case of negative pairing) as it should be. At the same time, when pooling two unequal population variances, the population effect size will also be lower (in case of positive pairing) or larger (in case of negative pairing) as it should be. As a consequence, the distorsion cannot be seen through the difference between the expected estimator and the population effect size measure. For this reason, the bias and variance of Hedges' $g_s$ will not be taken into account in the following comparisons.  

Figures \ref{fig:idHetbal1} and \ref{fig:idHetbal2} are dedicated to scenarios where population variances are unequal between groups and sample sizes are equal (condition c). In Figure \ref{fig:idHetbal1}, scenarios are subdivided as a function of the sample sizes and one can notice that all estimators are consistent, as their bias and variance decrease when the total sample size increases. In Figure \ref{fig:idHetbal2}, scenarios are subdivided as a function of the $SD$-ratio. Because the comparison pattern remains very similar for all sample sizes, we present only scenarios when sample sizes equal 20. One should first notice that for all estimators in Figure \ref{fig:idHetbal2}, the relative variance seems to be much larger when $S_2>S_1$. This information should not be taken into account because it is only an artefact of our simulation conditions combined with the way we computed the relative variance. \footnote{We previously mentioned that when dividing the variance by $\delta^2$, we do not entirely remove the effect size effect. Actually, we introduce $\delta^2$ in the denominator of the first term, in the equation of the variance computation. Because we performed our simulations in order that $\sigma_1$ always equals 1, the smaller $S_2$, the larger the population effect size and therefore, the lower the relative variance.} 
One observes that the bias and variance of both Shieh's $g_s$ and Hedges' $g'_s$ are identical, for any departures from the normality assumption, because sample sizes are equal across groups. The bias of Shieh's $g_s$ (and then the bias of Hedges' $g'_s$) depends on the $SD$-ratio in order that the larger the difference between $\sigma_1$ and $\sigma_2$, the larger the bias. On the other side, the bias of Glass's $g_s$ does not depend on the $SD$-ratio. It is always a bit larger than the bias of  Shieh's $g_s$ (and Hedges' $g'_s$), but the difference decreases when $SD$-ratio get larger $\left(i.e. \;  \;\frac{\sigma_1}{\sigma_2} = 10 \; or \; 0.1\right)$. While the bias of Glass's $g_s$ does not depend on the $SD$-ratio, its variance decreases when the $SD$-ratio increases (i.e. when $S_C$ get larger, in comparison with $S_e$). This explains why the larger the $SD$-ratio, the larger the difference between the variance Glass's $g_s$ using either $S_1$ or $S_2$ as standardizer. Regarding, Shieh's $g_s$ and Hedges' $g_s$, their variance get larger when the $SD$-ratio goes further from 1. 

When samples are extracted from skewed distributions, the bias and variance of Glass's $g_s$  are sometimes smaller and sometimes larger than the bias of Shieh's $g_s$ and Hedges' $g_s$. This is mainly due to the fact that when two samples of same sizes are extracted from two skewed distributions with unequal variances (i.e. $\sigma_1 \neq\sigma_2$, the two last columns in Figure \ref{fig:idHetbal2}), there will be non-null correlations of opposite sign between the mean difference ($\bar{X_1}-\bar{X_2}$) and the standardizer of *all* estimators, depending on which population variance is the largest one \footnote{When population variances are unequal, a non-null correlation occurs between standardizers estimates and $\bar{X_1}-\bar{X_2}$. For standardizers computed based on both $S_1$ and $S_2$, the sign of the correlation between the standardizer and the means difference will be the same as the sign of the correlation between the mean difference and the estimate of the larger population variance. For interested readers, this is detailed in Supplemental Material 3.}. 

Figures \ref{fig:idHetunbal1} to \ref{fig:idHetunbal4} are dedicated to scenarios where both samples sizes and population variances differ across groups. Due to a high number of combinations between the sample sizes-ratio and the variances-ratio in our simulations, we decided to present only some conditions. Because equations in Table 3 revealed an interaction effect between the sample sizes ratio and the $SD$-ratio  on the bias and variance of Hedges' $g_s$ and Shieh's $g_s$ (see Supplemental Material 1), we chose to present all configurations where the larger $SD$ is 10 times larger than the smaller $SD$ (Figures \ref{fig:idHetunbal1} and \ref{fig:idHetunbal2}), and configurations where the larger $SD$ is twice larger than the smaller $SD$ (Figures \ref{fig:idHetunbal3} and \ref{fig:idHetunbal4}), in order to compare the effect of the sample sizes ratio on the bias and variance of all estimators when the $SD$-ratio is large ($\frac{\sigma_1}{\sigma_2}=10 \; or \; .1$ ) or medium ($\frac{\sigma_1}{\sigma_2}=2 \; or \; .5$).

When distributions are symmetric, the bias of Glass's $g_s$ only depends on the size of the control group and is therefore not impacted by neither the sample sizes ratio nor the total sample size. When comparing Figures \ref{fig:idHetunbal1} to \ref{fig:idHetunbal4}, one can also notice that the bias of Glass's $g_s$ does not depend on the $SD$-ratio either. Unlike the bias of Glass's $g'_s$, its variance depends on both sample sizes, but not in an equivalent way: most of the time, it is more efficient, in order to reduce the variance of Glass's $g_s$, to add subjects in the control group. Regarding Hedges' $g_s$ and Shieh's $g'_s$, their respective biases and variances depend on an interaction effect between the sample sizes ratio and the $SD$-ratio $\left( \frac{n_1}{n_2} \times \frac{\sigma_1}{\sigma_2} \right)$: the sample sizes ratio associated with the smallest bias and variance is not the same when the more variable group is 10 times more variable than the other group (Figures \ref{fig:idHetunbal1} and \ref{fig:idHetunbal2}) than when it is only twice more variable (Figures \ref{fig:idHetunbal3} and \ref{fig:idHetunbal4}). However, it is always true that the respective biases and variances of Hedges' $g_s$ and Shieh's $g_s$ are always smaller when there is a positive pairing between sample sizes and variances. When samples are extracted from skewed distributions, the bias and variance of Glass's $g_s$  are sometimes smaller and sometimes larger than the bias of Shieh's $g_s$ and Hedges' $g_s$, due to a combination of three factors: (1) which group is the largest one, (2) which group has the smallest standard deviation and (3) what is the correlation between the standardizer and the means difference.

In summary, when variances are unequal across populations, Glass's $g_s$ is sometimes better but also sometimes much worst than respectively Shieh's $g_s$ and Cohen's $g'_s$. The performance of Glass's $g_s$ highly depends on parameters that we  cannot control (i.e. an triple interaction) and for this reason, we do not recommend using it. When designs are not "too  unbalanced", Shieh's $g_s$ and Cohen's $g'_s$ are both appropriate but the further the sample sizes ratio is from 1, the larger the bias of Shieh's $g_s$ in order that in the end, our favourite measure is Cohen's $g'_s$.

#### Conclusion
 TO DO

