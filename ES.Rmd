---
title             : "What measure of effect size when comparing two groups based on their means?"
shorttitle        : "Effect size"
author: 
  - name          : "Marie Delacre" 
    affiliation   : "1"
    corresponding : yes    
    address       : "CP191, avenue F.D. Roosevelt 50, 1050 Bruxelles"
    email         : "marie.delacre@ulb.ac.be"
  - name          : "Christophe Leys"
    affiliation   : "1"
affiliation:
    
  - id            : "1"
    institution   : "Université Libre de Bruxelles, Service of Analysis of the Data (SAD), Bruxelles, Belgium"
authornote: |
abstract: |
keywords          : "keywords"
wordcount         : "X"
bibliography      : ["r-references.bib"]
floatsintext      : yes
figurelist        : no
tablelist         : no
footnotelist      : no
linenumbers       : yes
mask              : no 
draft             : no
documentclass     : "apa6"
classoption       : "man"
output:
  papaja::apa6_pdf:
    includes:
      after_body: "Appendix.tex"
header-includes:
  - \usepackage{rotating}
  - \DeclareDelayedFloatFlavor{sidewaysfigure}{figure}      
---

```{r setup, include = FALSE}
library("papaja")
library("knitr")
```

```{r render_appendix, include=FALSE}
render_appendix("Appendix.Rmd")
```

```{r analysis-preferences}
# Seed for random number generation
set.seed(42)
knitr::opts_chunk$set(cache.extra = knitr::rand_seed)
```

# Intro

During decades, researchers in social science [@Henson_Smith_2000] and education [@Fan_2001] have overestimated the ability of the null hypothesis (H0) testing to determine the importance of their results. The standard for researchers in social science is to define H0 as the absence of effect [@Meehl_1990]. For example, when comparing the mean of two groups, researchers commonly test the H0 that there is no mean differences between groups [@Steyn_2000]. Any effect that is significantly different from zero will be seen as sole support for a theory. 

Such an approach has faced many criticisms among which the most relevant to our concern is that the null hypothesis testing highly depends on sample size: for a given alpha level and a given difference between groups, the larger the sample size, the higher the probability of rejecting the null hypothesis [@Fan_2001; @Sullivan_Feinn_2012; @Olejnik_Algina_2000; @Kirk_2009]. It implies that even tiny differences could be detected as statistically significant with very large sample sizes [@McBride_et_al_1993]\footnote{Tiny differences might be due to sampling error, or to other factors than the one of interest: even under the assumption of random assignent (which is a necessary but not sufficient condition), it is almost impossible to be sure that the only difference between two conditions is the one defined by the factor of interest. Other tiny factors of no theoretical interest might slighly influence results, making the probability of getting an actual zero effect very low. This is what Meehl (1990) calls 'systematic noise'.}. 

Facing this argument, it has become an adviced practice to report the *p*-value assorted by a measure of the effect size, that is, a quantitative measure of the magnitude of the experimental effect [@Fan_2001; @Hays_1963;@Cohen_1965]. This practice is also highly endorsed by the American Psychological Association (APA) and the American Educational Research Association (AERA) [@APA_2010;@AERA_2006]. However, limited studies properly report effect size in the last several decades. 

Generally, there is a high confusion between the effect size and other related concepts such as the Applied significance\footnote{In our conception  Applied significance" encompass all what refers to the relevance of an effect in real life, e.g. clinical, personnal, social, professionnal.}. Moreover, there are several situations that call for effect size measures and in the current litterature, it's not always easy to know which measure using in a specific context. We will therefore introduce this paper with 3 sections in which we will:   
1. Clearly define what is a measure of effect size;  
2. Listing the different situations that call for effect sizes measure;  
3. Define required properties of the effect size estimators, as a function of the situations. 

Moreover, it is highly recommended to compute a confidence interval around the point effect size. In a fourth section, we will therefore summarize how it is an added value to mention the confidence interval around the effect size.

After these general adjustments, we will focus our attention on “between-subject” designs where individuals are randomly assigned into one of two independant groups and groups scores are compared based on their means\footnote{We made this choice because *t*-tests are still the most commonly used tests in the field of Psychology.}. Because it has been widely argued that there are many fields in psychology where the assumption of equal variances between two populations is ecologically unlikely [@Erceg-Hurn_Mirosevich_2008; @Grissom_2000; @Delacre_et_al_2017], it is becoming more common in statistical software to present a *t*-test that does not hold on this assumption by default, namely the Welch’s *t*-test (e.g., R, Minitab). However, similar issues for the measures of effect sizes has received less attention [@Shieh_2013], and Cohen’s $d_s$ remains persistent\footnote{For example, in Jamovi, Cohen's ds is provided, whatever one performs Student's or Welch's t-test.}. One possible reason is that researchers cannot find a consensus on which alternative should be in use [@Shieh_2013]. We will limit our study to the standardized mean difference, called the *d*-family, because it is the dominant family of estimators of effect size when comparing two groups based on their means [@Peng_et_al_2013; @Shieh_2013], and we will see that even in this very specific context, there is little agreement between researchers as to which is the most suitable estimator. According to us, the main reason is that it is difficult, based on currently existing measures, to optimally serves all the purposes of en affect size measure. Throughout this section, we will:  
1. Present the main measures of the *d*-family that are proposed in the literature,related to the purpose they serve, and introduce a new one, namely the "transformed Shieh's *d*" that should help at reaching all the purposes simultaneously;  
2. Present and discuss the results of simulations we performed, in order to compare existing measures and the new introduced one;    
3. Summarize our conclusions in practical recommandations. In this section, we will provide useful tools (i.e. R package) to compute relevant measures of effect sizes and related information.

# Measure of effect size: what it is, what it is not 

The effect size is commonly refered to the practical significance of a test. @Grissom_and_kim_2005 define the effect size as the extent to which results differ from what is implied by the null hypothesis. In the context of the comparison of two groups based on their mean, depending on the defined null hypothesis (considering the absence of effect as the null hypothesis), we could define the effect size either as the magnitude of differences between parameters of two populations groups are extracted from [e.g. the mean; @Peng_and_Chen_2014] or as the magnitude of the relation between one dichotomous factor and one dependent variable [@AERA_2006]. Both definitions refers to as the most famous families of measures of effect sizes [@Rosenthal_1994]: respectively the *d*-family and the *r*-family.

Very often, the contribution of the measures of effect size is overestimated. First, benchmarks about what should be a small, medium or large effect size might have contribued at seeing the effect size as a measure of the importance or the relevance of an effect in real life, but it is not [@Stout_Ruble_1995]. The effect size is only a mathematical indicator of the magnitude of a difference, which depends on the way a variable is converted into numerical indicator. In order to assess the meaningfulness of an effect, we should be able to relate this effect with behaviors/meaningful consequences in the real world [@Andersen_et_al_2007]. For example, let us imagine a sample of students in serious school failure who are randomly divided into two groups: an experimental group following a training program and a control group. At the end of the training, students in the experimental group have on average significantly higher scores on a test than students in the control group, and the difference is large (e.g. 30 percents). Does it mean that students in the experimental condition will be able to pass to the next grade and to continue normal schooling? Whether the computed magnitude of difference is an important, meaningful change in everyday life refers to another construct that we will call the *Applied significance*. It refers to the interpretation of treatment outcomes and is neither statistical nor mathematical, it is related to underlying theory that posits an empirical hypothesis. In other words, the relation between *practical* and *Applied* significance is more a theoretical argument than a statistical one. 
 
Second, in the context of the comparison of two groups based on their means, it should not replace the null hypothesis testing. Statistical testing allows the researcher to determine whether the oberved departure from H0 occured by chance or not [@Stout_Ruble_1995]. while effect size estimators allow to assess the practical signficance of an effect, and as reminds @Fan_2001:  *"a practically meaningful outcome may also have occured by chance, and consequently, is not trustworthy"* (p.278). For this reason, the use of confidence intervals around the effect size estimate is highly recommended [@Bothe_Richardson_2011]. 

# Different purposes of effect size measures

Effect size measures can be used in an *inferential* perspective:   
- The effect sizes from previous studies can be used in a priori power analysis when planning a new study [@Sullivan_Feinn_2012;@Lakens_2013;@Stout_Ruble_1995;@Prentice_Miller_1992; @Wilkinson_1999];  
- We can also compute confidence limits around the point estimator [@Shieh_2013], in order to replace conventional hypothesis testing : if the null hypothesis area is out of the confidence interval, we can conclude that the null hypothesis is false. 

Measures of effect size can also be used in a *comparative* perspective, that is to assess the stability of results across designs, analysis, samples sizes [@Wilkinson_1999]. It includes:    
- To compare results of 2 or more studies [@Prentice_Miller_1992];  
- To incorporate results in meta-analysis [@Lakens_2013;@Wilkinson_1999;@Stout_Ruble_1995; @Nakagawa_and_Cuthill_2007;@Li_2016].  

Finally, effect size measures can be used for *interpretative* purposes: in order to assess the practical significance of a result [beyond statistical significance; @Lakens_2013;@Prentice_Miller_1992;@APA_2010].  

# Properties of a good effect size estimator

The estimate of an estimator depends on the sampling. That is to say, based on different samples extracted from the same population, one would  obtain different estimates of the same estimator. The *sampling distribution* of the estimator is the distribution of all estimates, based on all possible samples of size *n* extracted from one population. Studying the sampling distribution is very useful, as it allows to assess the goodness of an effect size estimator and more specifically, three desirable properties of a good estimator for inferential purposes: **unbiasedness**, **consistency** and **efficiency** [@Wackerly_et_al_2008].

An estimator is unbiased if the distribution of estimates is centered around the true population parameter. On the other hand, an estimator is positively (or negatively) biased if the distribution is centered around a value that is higher (or smaller) than the true population parameter (see Figure \ref{fig:BIAS}). In other words, the bias tells us if estimates are good, on average. The *bias* of a point estimator $\hat{\delta}$ can be computed as follows:

\begin{equation} 
\hat{\delta}_{bias}=E(\hat{\delta})-\delta
(\#eq:BIAS)
\end{equation} 

Where $E(\hat{\delta})$ is the expectency of the sampling distribution of the estimator (i.e. the average estimate) and $\delta$ is the true parameter. 
```{r "BIAS", echo=FALSE, fig.width = 15,fig.height=8,out.width = '400px',fig.cap = "Samplig distribution for a positively biased (left), an unbiased (center) and a negatively biased estimator (right)"}
par(mai=c(.5,1,.5,1),mfrow=c(1,3),cex.axis=2)
plot(function(x) dnorm(x,mean=2,sd=2),-6, 10,xlab="",ylab="",main ="",axes=F,lty=1,xlim=c(-6,10),ylim=c(0,.2),lwd=1,cex.lab=1.2)
segments(2,0,2,dnorm(2,mean=2,sd=2))
segments(0,0,0,dnorm(0,mean=2,sd=2),lty=2,lwd=2)
axis(side=1,at=seq(-6,10,2),labels=c(rep("",3),expression(delta),expression(paste("E(",hat(delta),")")),rep("",4)),col="white",cex=2)
plot(function(x) dnorm(x,mean=0,sd=2),-8, 8,xlab="",ylab="",main ="",axes=F,lty=1,xlim=c(-8,8),ylim=c(0,.2),lwd=1,cex.lab=1.2)
segments(0,0,0,dnorm(0,mean=0,sd=2))
segments(0,0,0,dnorm(0,mean=0,sd=2),lty=2,lwd=2)
axis(side=1,at=seq(-6,10,2),col="white",labels=c(rep("",3),expression(paste(delta,"=E(",hat(delta),")")),rep("",5)))
plot(function(x) dnorm(x,mean=-2,sd=2),-10, 6,xlab="",ylab="",main ="",axes=F,lty=1,xlim=c(-10,6),ylim=c(0,.2),lwd=1,cex.lab=1.2)
segments(-2,0,-2,dnorm(2,mean=2,sd=2))
segments(0,0,0,dnorm(0,mean=2,sd=2),lty=2,lwd=2)
axis(side=1,at=seq(-6,10,2),labels=c(rep("",2),expression(paste("E(",hat(delta),")")),expression(delta),rep("",5)),col="white")
```

Moreover, since there is a strong relationship between the bias and the size of any estimator (the larger an estimator, the larger the bias), it might be interesting to also define the *relative bias* as the ratio between the bias and the population estimator:

\begin{equation} 
\hat{\delta}_{relative \; bias}=\frac{E(\hat{\delta})-\delta}{\delta}
(\#eq:RELBIAS)
\end{equation} 

Bias informs us about the goodness of estimates averages, but says nothing about individual estimates. Imagine a situation where the distribution of estimates is centered around the real parameter but with such a large variance that some point estimates are very far from the center. It would be problematic, as long as we have only one estimate, the one based on our sample, and we don't know how far is this estimate from the center of the sampling distribution. We hope that *all* possible estimates are close enough of the true population parameter, in order to be sure that for *any* estimate, one has a correct estimation of the real parameter. In other words, we expect the variability of estimates around the true population parameter to be as small as possible. It refers to the **efficiency** of the point estimator and can be computed as follows:

\begin{equation} 
\hat{\delta}_{efficiency}=Var(\hat{\delta})
(\#eq:EFFICIENCY)
\end{equation} 

Where $Var(\hat{\delta})$ is the variance of the sampling distribution of the estimator. Among all unbiased estimators, the more efficient will be the one with the smallest variance. Again, the variance of an estimator is a function of its size (the larger the estimator, the larger the variance) and therefore, we might be interested in computing the *relative variance* as the ratio between the variance and the square of the population estimator:

\begin{equation} 
\hat{\delta}_{relative \; variance}=\frac{Var(\hat{\delta})}{\delta^2}
(\#eq:RELBIAS)
\end{equation} 

Note that both unbiasedness and efficiency are very important. An unbiased estimator with such a large variance that somes estimates are extremely far from the real parameter is as undesirable as a parameter which is highly biased. In some situations, it is better to have a very slightly biased estimator with a tigh shape around the biased value, so each estimate remains relatively close to the true parameter, than an unbiased estimator with a large variance [@Raviv]. 

Finally, the last property of a good point estimator is **consistency**: consistency means that the bigger the sample size, the closer the estimate of the population parameter. In other words, the estimates *converge* to the true population parameter. 

Beyond the inferential properties, @Cumming_2013 reminds that an effect size estimator need to have a constant value across designs in order to be easily interpretable and to be included in meta-analysis. In other word, it should achieve the property of **generality**.

# Confidence interval around a point estimator

We already mentioned that confidence interval around a point estimate could replace conventional hypothesis testing. The Confidence interval delivers all the information that $p$-value does: if the null values are out of the confidence interval, it means that an hypothesis test would have resulted in a *p*-value below the nominal alpha level. At the same time, it provides extra informations about the precision of the sample estimate for inferential purposes, and therefore on how confident we can be in the observed results [@Ellis_2015; @Altman_2005]: the narrower the interval indicates, the higher the precision and the lower the incertainty. On the other hand, the wider the confidence interval, the more the data lacks precision (for example, because the sample size were too small).

# Different measures of effect sizes

The *d*-family effect sizes are commonly used with “between-subject” designs where individuals are randomly assigned into one of two independant groups and groups scores means are compared. The population effect size is defined as follows: 
  
\begin{equation} 
\delta = \frac{\mu_{1}-\mu_{2}}{\sigma} 
(\#eq:Cohendelta)
\end{equation} 

Where both populations follow a normal distribution with the mean $\mu_j$ in the $j^{th}$ population (j=1,2) and standard deviation $\sigma$. They exist different estimators of this effect size measure varying as a function of the chosen standardizer ($\sigma$). For all estimators, the mean difference is estimated by the difference of both sample means ($\bar{X}_1-\bar{X}_2$). When used for inference, some of them rely on both assumptions of normally distributed residuals and equality of variances, while others rely solely on the normally distributed residuals assumption. 

## Alternatives when variances are equal between groups

The most common estimator of $\delta$ is Cohen's $d_{s}$ where the sample mean difference is divided by a pooled error term [@Cohen_1965]: 

\begin{equation} 
Cohen's \; d_s = \frac{\bar{X}_1-\bar{X}_2}{\sqrt{\frac{(n_1-1) \times SD_1+(n_2-1) \times SD_2}{n_1+n_2-2}}} 
(\#eq:Cohends)
\end{equation} 

Where $SD_j$ is the standard deviation of the $j^{th}$ sample and $n_j$, the sample size of the $j^{th}$ sample (j=1,2). The reasoning behind this measure is that considering both samples as extracted from a common population variance [@Keselman_et_al_2008], we achieve a more accurate estimation of the population variance by pooling both estimates of this parameter (i.e $SD_1$ and $SD_2$) and because the larger the sample size, the more accurate the estimate, we give more weight to the estimate based on the larger sample size. Unfortunately, even under the assumptions that residuals are independant and identically normally distributed with the same variance across groups, Cohen's $d_s$ is known to be positively biased [@Lakens_2013] and for this reason, @Hedges_Olkin_1985 has defined a bias-corrected version,  which is referred to: 

\begin{equation} 
Hedge's \; g_s = Cohen's \; d_s \times (1-\frac{3}{4 \times (n_1+n_2)-9}) 
(\#eq:Hedgesgs)
\end{equation} 

The pooled error term is the best choice when variances are equal between groups  [@Grissom_Kim_2001] but they may not be well advised for use with data that violates this assumption [@Kelley_2005;@Grissom_Kim_2001; @Cumming_2013; @Grissom_and_kim_2005; @Kelley_2005; @Shieh_2013]. In case of a positive pairing (i.e. the group with the larger sample size is extracted from the population with the larger variance), the population variance will be over-estimated and therefore, the estimator will be lower as it should be. On the other side, in case of negative pairing (i.e. the group with the larger sample size is extracted from the population with the smaller variance), the estimator will be larger as it should be. Because the assumption of equal variances across populations is very rare in practice [@Glass_et_al_1972; @Cain_et_al_2017; @Micceri_1989; @Yuan_et_al_2004; @Erceg-Hurn_Mirosevich_2008;@Grissom_2000; @Delacre_et_al_2017; @Delacre_et_al_2019], both Cohen's $d_s$ and Hedge's $g_s$ should be abandoned in favor of a robust alternative to unequal population variances.

## Alternatives when variances are unequal between populations

In his review, @Shieh_2013 mention three alternative available in the literature: the sample mean difference, divided by the non pooled average of both variance estimates (A), the Glass's $d_s$ (B) and the Shieh's $d_s$ (C).  

The sample mean difference, divided by the non pooled average of both variance estimates (A) was suggested by @Cohen_1988. We immediately exclude this alternative because it suffers of many limitations:    
- it results in a variance term of an artificial population and is therefore very difficult to interpret [@Grissom_Kim_2001];  
- unless both sample sizes are equal, the variance term does not correspond to the variance of the mean difference [@Shieh_2013];    
- unless the mean difference is null, the measure is biased. Moreover, the bigger the sample size, the larger the variance around the estimate.  

When comparing one control group with one experimental group, @Glass_et_al_1981 recommend using the $SD$ of the control group as standardizer. It is also advocated by @Cumming_2013, because according to him, it is what makes the most sense, conceptually speaking. 

\begin{equation} 
Glass's \; d_s = \frac{\bar{X}_{experimental} - \bar{X}_{control}}{SD_{control}}
(\#eq:Glassds)
\end{equation} 

One argument in favour of using the $SD$ of the control group as standardizer is the fact that it is not affected by the experimental treatment. When it is easy to identify which group is the "control" one, it is therefore convenient to compare the effect size estimation of different designs studying the same effect. However, defining this group is not always obvious [@Coe_2002]. This could induce large ambiguity because depending of the chosen $SD$, as standardizer, measures could be substantially diﬀerent [@Shieh_2013].  Glass $d_s$ also have limitations when used for inference. The standardizer is estimated from only a part of the sample (since only one group is taken into accoung in variance estimation), which might potentially reduce accuracy. While it is a consistant measure, it can be shown that it can be highly positively biased when there are less than 300 participants [@Hedges_1981; @Olejnik_Hess_2001], especially for small effect sizes. 

Kulinskaya and Staudte (2007) adviced the use of a standardizer that take the sample sizes allocation ratios into account, in addition to the variance of both samples. It results in a modification of the exact *SD* of the sample mean difference: 
      
\begin{equation} 
Shieh's \; d_s = \frac{\bar{X}_1 - \bar{X}_2}{\sqrt{SD_1^2/q_1+SD_2^2/q_2}}; \;\;\; q_j=\frac{n_j}{N} (j=1,2)
(\#eq:Shiehds)
\end{equation} 

Where $N = n_1+n_2$. According to the statistical properties of Welch’s statistic under heteroscedasticity, it does not appear possible to define a proper standardised effect size without accounting for the relative group size of subpopulations in a sampling scheme. At the same time, the lack of generality caused by taking this specificity of the design into account has led @Cumming_2013 to question its usefulness in terms of interpretability: when keeping constant the mean difference ($\bar{X_1}-\bar{X_2}$) as well as $SD_1$ and $SD_2$, Shieh's $d_s$ will vary as a function of the sample sizes allocation ratio (dependency of Shieh's $d_s$ value on the sample sizes allocation ratio is detailed and illustrated in Appendix 1, and also in the following shiny application: https://mdelacre.shinyapps.io/improve-the-interpretability-of-shieh-s-d-shiny-app/).

Fortunately, this paradox can be resolved. It is possible to find a modified measure of Shieh's $d_s$ that does not depend on sample sizes ratio, in answering the following question: "whatever the real sample sizes ratio, what value of Shieh's $d_s$ would have been computed if design were balanced (i.e. $n_1 = n_2$), keeping all other parameters constant? " 

It can be shown that the relationship between Shieh's $\delta$ when samples sizes are equal between groups and Shieh's $\delta$ for any other sample sizes allocation ratios can be expressed as follows:

\begin{equation} 
Shieh's \; \delta_{n_1=n_2}= Shieh's \; \delta \times \frac{(nratio+1) \times \sigma_{n_1 \neq n_2}}{2 \times \sigma_{n_1=n_2} \times \sqrt{nratio}}
(\#eq:shiehvsbaldesignPOP)
\end{equation} 

With $$nratio= \frac{n_1}{n_2}$$
$$\sigma_{n_1=n_2}= \sqrt{\frac{\sigma_1^2+\sigma_2^2}{2}}$$  
$$\sigma_{n_1 \neq n_2} = \sqrt{(1- \frac{n_1}{N}) \times \sigma_1^2+(1- \frac{n_2}{N}) \times \sigma_2^2}$$

$Shieh's \; \delta_{n_1=n_2}$ can thefore be estimated using this equation:

\begin{equation} 
Shieh's \; d^*_s= Shieh's \; d_s \times \frac{(nratio+1) \times SD_{n_1 \neq n_2}}{2 \times SD_{n_1=n_2} \times \sqrt{nratio}}
(\#eq:shiehvsbaldesign)
\end{equation} 

With $$SD_{n_1=n_2}= \sqrt{\frac{SD_1^2+SD_2^2}{2}}$$ and 
$$SD_{n_1 \neq n_2} = \sqrt{(1- \frac{n_1}{N}) \times SD_1^2+(1- \frac{n_2}{N}) \times SD_2^2}$$

$Shieh's \; d^*_s$ can be compared across two different studies using different sample sizes allocation ratio and could be included in meta-analysis.  
    
## Monte Carlo Simulations

### Simulation 1: assessing the bias, efficiency and consistency of 5 estimators

#### Method
We performed Monte Carlo simulations using R (version 3.5.0) to assess the bias, efficiency and consistency of Cohen's $d_s$, Hedge's $g_s$, Glass's $d_s$ (using respectively the sample $SD$ of the first or second group as a standardizer), Shieh's $d_s$ and our transformed measure of Shieh's $d_s$, that we will note later $d_s^*$. 

A set of 100,000 datasets were generated for 1,008 scenarios as a function of different criterions that will be explained below. In 252 scenarios, samples were extracted from a normally distributed population and in 756 scenarios, samples were extracted from non normal population distributions. In order to assess the goodness of estimators under realistic deviations from the normality assumption, we referred to the review of @Cain_et_al_2017. Based on their investigation\footnote{Cain et al. (2017) investigated 1,567 univariate distributions from 194 studies published by authors in Psychological Science (from January 2013 to June 2014) and the American Education Research Journal (from January 2010 to June 2014). For each distribution, they computed the Fisher's skewness (G1) and kurtosis (G2). }, @Cain_et_al_2017 found values of kurtosis from G2 = -2.20 to 1,093.48. According to their suggestions, throughout our simulations, we kept constant the population kurtosis value at the 99th percentile of their distribution, i.e. G2=95.75. Regarding skewness, we simulated population parameter values which correspond to the 1st and 99th percentile of their distribution, i.e. respectively G1 = -2.08 and G1 = 6.32. We also simulated null population parameter values (i.e. G1 = 0), in order to assess the main effect of high kurtosis on the goodness of estimators. All possible combinations of population skewness and kurtosis and the number of scenarios for each combination are summarized in Table 1.

Table 1.
*Number of Combinations of skewness and kurtosis in our simulations*

|                         |               |               | __Kurtosis__ |               
| :---------------------: | :-----------: |:-------------:|:------------:|:-------------:|
|                         |               |     0         |   95.75      |    **TOTAL**    |
|                         |               |---------------|--------------|---------------|
|                         |        0      |     252       |     252      |     **504**     | 
|                         |               |               |              |               |
|      __Skewness__       |      -2.08    |      /        |     252      |     **252**     |
|                         |               |               |              |               |
|                         |      6.32     |        /      |     252      |     **252**     |
|                         |               |               |              |               |
|                         |    **TOTAL**    |    **252**      |    **756**     |    **1008**     |

*Note.* Fisher's skewness (G1) and kurtosis (G2) are presented in Table 1. The 252 combinations where both G1 and G2 equal 0 correspond to the normal case. 

For the 4 resulting combinations of skewness and kurtosis (see Table 1), all other parameter values were chosen in order to illustrate the consequences of factors known to play a key role on goodness of estimators. We manipulated the population mean difference ($\mu_1-\mu_2$), the sample sizes (*n*), the sample size ratio (*n*-ratio = $\frac{n_1}{n_2}$), the population *SD*-ratio (i.e. $\frac{\sigma_1}{\sigma_2}$), and the sample size and population variance pairing. In our scenarios, $\mu_2$ was always 0 and $\mu_1$ varied from 1 to 4, in step of 1 (so does $\mu_1-\mu_2$)\footnote{In the original plan, we had added 252 simulations in which mu1 and mu2 were both null. We decided to not present the results of these simulations, because the relative bias and the relative variance appeared to us to be very useful to fully understand the estimators comparison, and computing them is impossible when the real mean difference is zero. }. Moreover, $\sigma_1$ always equals 1, and $\sigma_2$ equals .1, .25, .5, 1, 2, 4 or 10 (so does $\frac{\sigma_1}{\sigma_2}$). The simulations for which both $\sigma_1$ and $\sigma_2$ equal 1 are the particular case of homoscedasticity (i.e. equal population variances across groups). Sample size of both groups ($n_1$ and $n_2$) were 20, 50 or 100. When sample sizes of both groups are equal, the *n*-ratio equals 1 (it is known as a balanced design). All possible combinations of *n*-ratio and population *SD*-ratio were performed in order to distinguish positive pairings (the group with the largest sample size is extracted from the population with the largest *SD*), negative pairings (the group with the smallest sample size is extracted from the population with the smallest *SD*), and no pairing (sample sizes and/or population *SD* are equal across all groups). In sum, the simulations grouped over different sample sizes yield 5 conditions based on the *n*-ratio, population *SD*-ratio, and sample size and population variance pairing, as summarized in Table 2. 
Table 2.
*5 conditions based on the n-ratio, SD-ratio, and sample size and variance pairing*

|                               |             |             |__*n*-ratio__|             |
| :---------------------------: | :---------: |:----------: |:-----------:|:-----------:|
|                               |             |    **1**    |    **>1**   |    **<1**   |
|                               |             |------------ |-------------|-------------|
|                               |    **1**    |      a      |      b1     |      b2     | 
|                               |             |             |             |             |
|      __*SD*-ratio__           |   **>1**    |      c1     |      d1     |      e1     |
|                               |             |             |             |             |
|                               |   **<1**    |      c2     |      e2     |      d2     |

*Note.* The *n*-ratio is the sample size of the first group ($n_1$) divided by the sample size of the second group ($n_2$). When all sample sizes are equal across groups, the *n*-ratio equals 1. When $n_1 > n_2$, *n*-ratio > 1, and when $n_1 < n_2$, *n*-ratio < 1. *SD*-ratio is the population *SD* of the first group ($\sigma_1$) divided by the population *SD* of the second group ($\sigma_2$). When $\sigma_1=\sigma_2$, *SD*-ratio = 1. When $\sigma_1>\sigma_2$, *SD*-ratio > 1. Finally, when $\sigma_1<\sigma_2$, *SD*-ratio < 1.


#### Results
Before detailing estimators comparison for each condition, it might be interesting to make some general comments. 

1) When the normality assumption is met (i.e. when G1 and G2 = 0, left in Figures 3 to 7), bias and variance of all estimators is so small that any detected differences are marginal. However, the further from the normality assumption (i.e. when moving from left to right in Figures 3 to 7), the larger the value of all envisaged indicators of goodness (i.e. bias, relative bias and efficiency). Note that in a purpose of readability, the ordinate axis is not on the same scale depending on the combination G1/G2.  However, if the distribution shape influences all our indicators of goodness, most of the time, there is no appearant interaction effect between estimators and distribution shape: the general appearance of barplots is almost always the same for all combinations of skewness and kurtosis (the only is exception is for the Glass's $d_s$ when population distributions are skewed, as it will be described later). As a conclusion, the further from the normality assumption, the larger the below mentioned differences between estimators.

2) The fact that the bias of all estimators is very small when the normality assumption is met does not mean that all estimators are relevant in any conditions when the normality assumption is met. Because of the pooled error term, Cohen's $d_s$ and Hedge's $d_g$ should be avoided when population variances and sample sizes are unequal across groups. Indeed, as reminded in the section "Different mesures of effect size", the pooled error term will be overestimated when there is negative pairing and underestimated when there is a positive pairing. However, because the pooled standard deviation will be poorly estimated, both at sample and population levels, this cannot be seen throughout the size of the bias (i.e. bias = $E(\hat{\delta})-\delta$ and both $E(\hat{\delta})$ and $\delta$ are badly estimated).

3) Throughout this section, we will **compare** the goodness of different estimators. We chose very extreme (although realistic) conditions, and we know that none of the parametric measures of effect size will be robust against such extreme conditions. Our goal is therefore to study the robustness of the estimators against normality violations only in comparison with the robustness of other indicators, but not in absolute terms. 

After these general remarks, we will analyze each condition separately. In all Figures presented below, averaged results for each sub-condition are presented under five different configurations of distributions, using the legend described in Figure \ref{fig:legend}.

```{r "legend", echo=FALSE, fig.width = 100,fig.height=100,out.width = '400px',fig.cap = "Legend"}
knitr::include_graphics("C:/Users/Marie/Documents/Github_projects/Effect-sizes/Scripts outputs/Quality of ES measures/Graphs/legend.png")
```

```{r "idHombal", fig.env = "sidewaysfigure",echo=FALSE, fig.cap="Bias and efficiency of five estimator of standardized mean difference, when variances and sample sizes are equal across groups (condition a)",fig.width = 15,fig.height=8,out.width = '20%',fig.show='hold',fig.align='center'}
myimages<-list.files("C:/Users/Marie/Documents/Github_projects/Effect-sizes/Scripts outputs/Quality of ES measures/Graphs/id_Hom_bal", pattern = "bias_eff", full.names = TRUE)
knitr::include_graphics(myimages)
```

```{r "idHetbal", fig.env = "sidewaysfigure",echo=FALSE, fig.cap="Bias and efficiency of five estimator of standardized mean difference, when variances are unequal across groups and sample sizes are equal (condition c)",fig.width = 15,fig.height=8,out.width = '20%',fig.show='hold',fig.align='center'}
myimages<-list.files("C:/Users/Marie/Documents/Github_projects/Effect-sizes/Scripts outputs/Quality of ES measures/Graphs/id_Het_bal", pattern = "bias_eff", full.names = TRUE)
knitr::include_graphics(myimages)
```

Figures \ref{fig:idHombal} and \ref{fig:idHetbal} show that for all configurations where sample sizes are equal between groups (conditions a and c), estimator bias tends to decrease and precision is also improved with increasing sample sizes, meaning that all estimators are consistent. Moreover, Shieh's $d_s$ and Shieh's $d^*_s$ are identical, because our transformation is operant only when the sample sizes ratio differs from 1. We can demonstrate that the bias of Shieh's $d_s$ and Shieh's $d_s^*$ is exactly half the size of the bias of Cohen's $d_s$, and that their variance is exactly four times smaller than the variance of Cohen's $d_s$. Due to the relation described in equation \ref{eq:cohenshieh} when sample sizes are equal between groups, such proportions mean that relative to their respective true effect size, Cohen's $d_s$, Shieh's $d_s$ and Shieh's $d^*_s$ perform all as well, as we can see in the second and fourth rows in Figures \ref{fig:idHombal} and \ref{fig:idHetbal}. These two rows also reveal that the relative bias and variance of Hedges's $g_s$ is also identical to the three prementioned ones. 

\begin{equation} 
Shieh's \; \delta_{n_1=n_2}= \frac{Cohen's \; \delta_{n_1=n_2}}{2}
(\#eq:cohenshieh)
\end{equation} 

When samples are extracted from symmetric ditributions (the two first columns in Figures \ref{fig:idHombal} and \ref{fig:idHetbal}), both glass's $d_s$ estimates (i.e. using $SD_1$ and $SD_2$) show least precision and highest bias rates, in comparison with all other measures, which is not surprising, as the standardizer is estimated based on half the sample size. In terms of relative bias, Glass's $d_s$ shows similar performances when using either $SD_1$ or $SD_2$ as standardizer\footnote{When looking at the raw bias in Figure 4, one could believe that the bias is always more important when choosing SD2 as a standardizer. It is only an artefact of simulations. The bias is always more important when choosing the sample extracted from the smaller population SD as standardiser, because it results in a larger effect size estimate, and the larger the effect size estimate, the larger the raw bias. In our simulations, while the population SD of the first group always equals 1, in half of the simulations in condition c, the population SD of the second group is lower than 1 (meaning that the more biased Glass's estimate will occure when choosing SD2 < 1 as standardiser), and in the other half, the population SD of the second group is larger than 1 (meaning that the more biased Glass's estimate will occure when choosing SD1 as standardizer). Of course, for X, a constant mean difference and z, the standardizer, X/z will always result in a larger effect size measure when z < 1. This is confirmed by the identical average relative bias for both measures of Glass's ds.}, however, when population variances differ across groups, the relative variances are unequal (Figure \ref{fig:idHetbal}). It is well known that in equation \ref{eq:Glassds}, the variance of the numerator estimate (i.e. $\bar{X_1}-\bar{X_2}$) depends on both $\sigma_1$ and $\sigma_2$, as reminded in equation \ref{eq:sdmeandiff}:

\begin{equation} 
\sigma^2_{\bar{X}_1-\bar{X}_2}=\frac{\sigma^2_1}{n_1}+\frac{\sigma^2_2}{n_2}
(\#eq:sdmeandiff)
\end{equation} 

On the other side, $\sigma$ is estimated based on only one sample SD (either $SD_1$ or $SD_2$). When computing the Glass's $d_s$ with the estimate of the smaller population SD as standardizer (i.e. $SD_2$ in Figure \ref{fig:idHetbal2}, and $SD_1$ in Figure \ref{fig:idHetbal3}), the estimate of the larger population SD will increase the variance of the numerator in equation \ref{eq:Glassds} but will not impact the variance of the denominator, resulting in a more variable estimator. When choosing the estimate of the larger population SD as standardizer, the estimate of the smaller population SD will decrease the variance of the numerator in equation \ref{eq:Glassds} but will not impact the variance of the denominator, resulting in a less variable estimator. CA SEMBLE ETRE LE CONTRAIRE QD DISTRIBUTION NORMALE...BIZARRE?\footnote{Remind that in our simulations, the first population SD always equal 1, and the second population SD varies from .1 to 10. The difference in terms of relative variance is more important when comparing SD1=1 and SD2=10 as standardizer than when comparing SD1=1 and SD2=.1 as standardizer, explaining why the difference between both Glass's estimators seems more important in FIgure 6 than in Figure 5} 

```{r "idHetbal2", fig.env = "sidewaysfigure",echo=FALSE, fig.cap="Bias and efficiency of Glass's ds, when sample sizes are equal across groups and population variances are unequal, when SD1 is larger than SD2 (condition c1)",fig.width = 15,fig.height=8,out.width = '20%',fig.show='hold',fig.align='center'}
myimages<-list.files("C:/Users/Marie/Documents/Github_projects/Effect-sizes/Scripts outputs/Quality of ES measures/Graphs/subconditions/hetBal", pattern = "SDsd", full.names = TRUE)
knitr::include_graphics(myimages)
```

```{r "idHetbal3", fig.env = "sidewaysfigure",echo=FALSE, fig.cap="Bias and efficiency of Glass's ds, when sample sizes are equal across groups and population variances are unequal, when SD1 is lower than SD2 (condition c2)",fig.width = 15,fig.height=8,out.width = '20%',fig.show='hold',fig.align='center'}
myimages<-list.files("C:/Users/Marie/Documents/Github_projects/Effect-sizes/Scripts outputs/Quality of ES measures/Graphs/subconditions/hetBal", pattern = "sdSD", full.names = TRUE)
knitr::include_graphics(myimages)
```

When samples are extracted from skewed distributions, both glass's $d_s$ estimators (i.e. using $SD_1$ and $SD_2$) remain the more biased and variable when variances are equal across groups. When variances are unequal across groups, glass's $d_s$ is sometimes more biased and variable than all other estimators, and sometimes less biased and variable. The explanation lies in two concepts:  
- a non null correlation between the sample means and standard deviations;  
- the number of observations based on which the standardizer is computed.  

When samples are extracted from skewed distributions, there is a non null correlation between the sample means and sample standard deviations, resulting in a non null correlation of opposite sign between $\bar{X_1}-\bar{X_2}$ and respectively $SD_1$ and $SD_2$.\footnote{when distributions are right-skewed, the correlation between sample means and standard deviation is positive. Because SD1 (SD2) is positively (negatively) correlated with the mean difference estimates, it results in a positive (negative) correlation between SD1 (SD2) and the mean difference. when distributions are left-skewed, the correlation between sample means and standard deviation is negative. Because SD1 (SD2) is positively (negatively) correlated with the mean difference estimates, it results in a negative (positive) correlation between SD1 (SD2) and the mean difference.}). When the population mean difference $\mu_1-\mu_2$ is positive (like in our simulations), Glass's $d_s$ is always more biased and variable when choosing as standardizer the $SD$ that is negatively correlated with $\bar{X_1}-\bar{X_2}$ (i.e. $SD_2$ when distributions are right-skewed and $SD_1$ when distributions are left-skewed). When the population mean difference is negative, the reverse is true. For interested reader, this is detailed and explained in Appendix 3. 

When the standardizer takes both $SD_1$ and $SD_2$ into account (i.e. all estimators but Glass's $d_s$), the correlation between standardizer and mean difference will be null, as long as population variances are equal across groups. However, when population variances are unequal across groups, the sign of the correlation between the standardizer and the mean difference will be the same as the one of the correlation between the mean difference and the estimates of the larger population variance (e.g. if samples are extracted from right-skewed distributions and $\sigma_2>\sigma_1$, there will be a negative correlation between the sample mean differences and standardizer). And so.... CONCLURE CE TRUC.

Figure \ref{fig:idHomrnull} shows that when population variances are equal but sample sizes are unequal between groups, as when sample sizes were equal, while estimators are consistent, glass's $d_s$ is generally more biased and variable that all other estimators. Again, this is due to the fact that the standardizer is estimated based on part of the total sample and unsurprisingly, the bias is even larger when choosing the $SD$ of the smallest group as a standardizer. As long as samples are extracted from symmetric distributions, the bias and variance of glass's $d_s$ is only a function of the sample size of the group from which standardizer is computed (because $\sigma_1=\sigma_2$). However, when samples are extracted from skewed distribution, because of the correlation between sample mean and sample SD, glass's $d_s$ becomes even more biased and variable when the chosen standardizer is negatively correlated with the mean difference and associated with the smaller sample size (i.e. when choosing $SD_2$ as standardizer, with $n_1 > n_2$ when distributions are right-skewed; and when choosing $SD_1$ as standardizer, with $n_1 < n_2$ when distributions are left-skewed). \footnote{Again, we should remind that in all our simulations, the population mean difference is positive. If mean difference were negative, glass's $d_s$ would be more biased and variable when the chosen standardizer is positively correlated with the mean difference and associated with the smaller sample size.}.

As previously, the bias of Shieh's $d_s$ is smaller than the Cohen's $d_s$ one (as well as the Hedge's $g_s$ one). However, the difference is smaller than previously. Remember that when sample sizes differ between groups, Shieh's $d_s$ is always more than twice smaller than Cohen's $d_s$ (see Appendix 1 for more details). As a consequence, if both Cohen's $d_s$ and Shieh's $d_s$ performed as well, the bias of Shieh's $d_s$ should be more than twice smaller than Cohen's $d_s$ bias (and the variance of Shieh's $d_s$ should be more than four time smaller than Cohen's $d_s$ bias), but it's not. It's confirmed by the second and fourth rows in Figure \ref{fig:idHomrnull} where we can see that the relative bias and variance of Shieh's $d_s$  are larger than the relative bias and variance of Cohen's $d_s$, that remains the best indicator in terms of bias. However, it is very interesting to note that our transformed Shieh's $d^*_s$ is on average less biased and variable than original Shieh's $d_s$, both if raw and relative terms. This measure seems to perform almost as well as Cohen's $d_s$.

```{r "idHomrnull", fig.env = "sidewaysfigure",echo=FALSE, fig.cap="Bias and efficiency of five estimator of standardized mean difference, when variances are equal across groups and sample sizes are unequal",fig.width = 15,fig.height=8,out.width = '20%',fig.show='hold',fig.align='center'}
myimages<-list.files("C:/Users/Marie/Documents/Github_projects/Effect-sizes/Scripts outputs/Quality of ES measures/Graphs/id_Hom_rnull", pattern = "bias_eff", full.names = TRUE)
knitr::include_graphics(myimages)
```

Figure \ref{fig:idHetrpos} and \ref{fig:idHetrneg} refer to conditions where there is a pairing between population variances and sample sizes. We know that in these configurations, the pooled variance will be poorly estimated (see the second remark at the beginning of the result section), and therefore, we will not discuss the Cohen's $d_s$ and Hedge's $g_s$.We will only compare the performance of Glass's $d_s$, Shieh's $d_s$ and Shieh's $d^*_s$.

Figure \ref{fig:idHetrpos} shows that when variances are unequal, and the largest group is associated with largest variance, the more biased and variable estimator is Glass's $d_s$ when choosing the standard deviation of the smallest group as standardizer. 
REM: AGAIN ONE OBSERVE THE SAME INTERACTION EFFECT BETWEEN STANDARDISER IN GLASS MEASURE AND SENSE OF ASYMMETRY AS OBSERVED FOR FIGURE 3 (IN SAME DIRECTION: WITH NEGATIVE SKEWNESS, WORST WHEN CHOOSING SD1 AND WHEN POSITIVE SKEWNESS, WORST WHEN CHOOSING SD2). Glass's $d_s$ when choosing the standard deviation of the largest group as standardizer, Shieh's $d_s$ and transformed Shieh's $d^*_s$ perform very similarly, both in terms of bias and efficiency.

```{r "idHetrpos", fig.env = "sidewaysfigure",echo=FALSE, fig.cap="Bias and efficiency of five estimator of standardized mean difference, when variances and sample sizes are unequal across groups, with positive correlation between them",fig.width = 15,fig.height=8,out.width = '20%',fig.show='hold',fig.align='center'}
myimages<-list.files("C:/Users/Marie/Documents/Github_projects/Effect-sizes/Scripts outputs/Quality of ES measures/Graphs/id_Het_rpos", pattern = "bias_eff", full.names = TRUE)
knitr::include_graphics(myimages)
```

Figure \ref{fig:idHetrneg} shows that when variances are unequal, and the largest group is associated with smallest variance, as in all other configurations, the more biased and variable estimator is Glass's $d_s$ when choosing the standard deviation of the smallest group as standardizer (sauf quand asymetrie négative... not true anymore when there is asymmetry... explain it).

```{r "idHetrneg", fig.env = "sidewaysfigure",echo=FALSE, fig.cap="Bias and efficiency of five estimator of standardized mean difference, when variances and sample sizes are unequal across groups, with negative correlation between them",fig.width = 15,fig.height=8,out.width = '20%',fig.show='hold',fig.align='center'}
myimages<-list.files("C:/Users/Marie/Documents/Github_projects/Effect-sizes/Scripts outputs/Quality of ES measures/Graphs/id_Het_rneg", pattern = "bias_eff", full.names = TRUE)
knitr::include_graphics(myimages)
```

In summary, Cohen's $d_s$ and Hedge's $d_s$ remain the best measure when the asssumption of equal variances is met. When variances are unequal across populations, Cohen's $d_s$ and Hedge's $g_s$ perform exactly as well as Shieh's $d_s$ and transformed Shieh's $d^*_s$, as long as sample sizes are equal across groups. However, when variances and sample sizes are both unequal across groups, Cohen's $d_s$ and Hedge's $g_s$ become irrelevant. Glass's $d_s$ is most of the time the more biased and variable measure. We presume this could be explained by the estimation of the $SD$ based on a subsample, because the bias is larger when standardizer is estimated based on the smallest group. Only under very specific conditions (when there is a negative correlation between sample sizes and variances and the sample size of the control group is larger than the sample size of the experimental group), Glass's $d_s$ performs the best in comparison with all other estimators.


#### Conclusion

SUMMARY GLASS: il y a plusieurs facteurs "aggravants":  
Pour le biais:
(1) SD calculé sur base du plus petit n (--> mesure plus variable et biaisée car distributions plus asymétrique) --> vrai pour toute distribution
(2) SD négativement corrélé avec la différence de moyenne quand mu1-mu2 > 0 (= choix de SD2 quand asymétrie positive, et de SD1 quand asymétrie négative, vu qu'on calcule m1-m2) OU SD positivement corrélé avec la différence de moyenne quand mu1-mu2 < 0 (= choix de SD1 quand asymétrie positive, et de SD2 quand asymétrie négative, vu qu'on calcule m1-m2). --> vrai seulement quand distributions asymétriques

Pour la variance:
(1) et (2) jouent, mais il y a en plus:
(3) SD calculé sur base du plus petit sigma




Shieh's $d_s$ and our transformed Shieh's $d^*_S$ are the only measure that have an acceptable bias and variance in all configurations. Considering the fact that our transformed Shieh's $d^*_s$ is much more generalizable (and therefore interpretable) than Shieh $d_s$, we would recommend the use of this measure in all situations, unless we have very good reason to believe that variances are the same across populations.

### Simulation 2: confidence intervals
TO DO
#### Method
### Results
#### Conclusion