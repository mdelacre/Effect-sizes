---
title             : "Theoretical Bias and variance, as a function of population parameters"
shorttitle        : "Theoretical Bias and variance"

author: 
  - name          : "Delacre Marie"
    affiliation   : "1"
    corresponding : no    # Define only one corresponding author
    address       : ""
    email         : ""

affiliation:
  - id            : "1"
    institution   : "ULB"

keywords          : "keywords"
wordcount         : "X"

floatsintext      : no
figurelist        : no
tablelist         : no
footnotelist      : no
linenumbers       : yes
mask              : no
draft             : no

documentclass     : "apa6"
classoption       : "man"
output            : papaja::apa6_pdf
---

# The bias 

For all estimators, when the population effect size is null so is the bias. For each estimator, We will subdivise all configurations when there is a non-null population effect into 3 conditions:  
- when variances are equal across groups,   
- when variances are unequal across groups, with equal sample sizes  
- when variances are unequal across groups, with unequal sample sizes  

## Cohen's $d_s$

### When variances are equal across populations

The **bias** of Cohen's $d_s$ is a function of total sample size (N) and the population effect size ($\delta_{Cohen}$):     

  + The larger the population effect size, the more Cohen's $d_s$ will overestimate $\delta_{Cohen}$.   
  
```{r biascohendNsize,include=FALSE}
Nsize=NULL
coeffmult=NULL
DF=NULL

sd1=2
sd2=2

for (i in 4:200){
  n1=i
  n2=i
  N = n1+n2
  Nsize=c(Nsize,N)
  df = n1+n2-2
  DF = c(DF,df)
  coeffmult = c(coeffmult,sqrt(df/2)*gamma((df-1)/2)/gamma(df/2))
}
```

```{r biascohendNsize2,fig.cap="...",echo=FALSE}
par(mfrow=c(1,2))
plot(Nsize,DF)
plot(Nsize,coeffmult)
```

  + The larger the total sample size, the lower the bias. The bias tends to zero when the total sample size tends to infinity (see Figure \ref{fig:biascohendNsize2})

```{r biascohendNratio,include=FALSE}
coeffmult <- NULL
nratio <- NULL
DF <- NULL

for (i in 10:190){
  
  N <- 200
  n1 <- i
  n2 <- N-n1
  sd1 <- 12
  sd2 <- 12
  
  nratio <- c(nratio,n1/n2)
  df <- n1+n2-2
  DF <- c(DF,df)
  coeffmult <- c(coeffmult,sqrt(df/2)*gamma((df-1)/2)/gamma(df/2))   
}
```

```{r biascohendNratio2,fig.cap="...",echo=FALSE}
par(mfrow=c(1,2))
plot(log(nratio),DF)
#nratio[DF==max(DF)]
plot(log(nratio),coeffmult,ylim=c(1,1.02))
#nratio[correction==min(coeffmult)]
```

Of course, considering the degrees of freedom, the sample size ratio does not matter...(see Figure \ref{fig:biascohendNratio2})

## Glass's $d_s$

Because degrees of freedom depend only on the sample size of the control group, there is no need to distinguish between cases where there is homoscedasticity or heteroscedasticity!   

The **bias** of Glass's $d_s$ is a function of the sample size of the control group ($n_c$) and the population effect size ($\delta_{glass}$):  

  + The larger the population effect size, the more Glass's $d_s$ will overestimate $\delta_{Glass}$.

```{r biasGlassctrlsize,include=FALSE}
Nctrl=NULL
coeffmult=NULL
DF=NULL

sd1=2
sd2=2

for (i in 4:200){
  n1=i
  n2=i
  Nctrl=c(Nctrl,n1)
  df = n1-2
  DF = c(DF,df)
  coeffmult = c(coeffmult,sqrt(df/2)*gamma((df-1)/2)/gamma(df/2))
}
```

```{r biasGlassctrlsize2,fig.cap="...",echo=FALSE}
par(mfrow=c(1,2))
plot(Nsize,DF)
plot(Nsize,coeffmult)
```

  + The larger the size of the control group, the lower the bias. The bias tends to zero when the sample size of the control group tends to infinity (see Figure \ref{fig:biasGlassctrlsize2})

## Cohen's $d'_s$

### When variances are equal across populations

When $s_1=s_2=s$: 
$$df_{Cohen's \; d'_s} = \frac{(n_1-1)(n_2-1)(2s^2)^2}{(n_2-1)s^4+(n_1-1)s^4} = \frac{(n_1-1)(n_2-1)4s^4}{s^4(n_1+n_2-2)} = \frac{4(n_1-1)(n_2-1)}{n_1+n_2-2}$$ 
One can see that degrees of freedom depend only on the total sample size (N) and the sample size allocation ratio. As a consequence, the **bias** of Cohen's $d'_s$ is a function of the population effect size ($\delta'_{Cohen}$), the sample size allocation ratio and the total sample size ($N$). 

  + The larger the population effect size, the more $Cohen's \; d'_s$ will overestimate $\delta'_{Cohen}$

```{r biascohendprimehomNratio,include=FALSE}
coeffmult <- NULL
nratio <- NULL
DF <- NULL

for (i in 10:190){
  
  N <- 200
  n1 <- i
  n2 <- N-n1
  sd1 <- 12
  sd2 <- 12
  
  nratio <- c(nratio,n1/n2)
  df <- ((n1-1)*(n2-1)*(sd1^2+sd2^2)^2)/((n2-1)*sd1^4+(n1-1)*sd2^4)
  DF <- c(DF,df)
  coeffmult <- c(coeffmult,sqrt(df/2)*gamma((df-1)/2)/gamma(df/2))   
  
}
```

```{r biascohendprimehomNratio2,fig.cap="...",echo=FALSE}
par(mfrow=c(1,2))
plot(log(nratio),DF)
#nratio[DF==max(DF)]
plot(log(nratio),coeffmult,ylim=c(1,1.02))
#nratio[coeffmult==min(coeffmult)]
```

  + The further the sample size allocation ratio is from 1, the larger the bias (see Figure \ref{fig:biascohendprimehomNratio2})

```{r biascohendprimehomNsize,include=FALSE}
Nsize=NULL
coeffmult=NULL
DF=NULL

sd1=2
sd2=2

for (i in 4:200){
  n1=i
  n2=i
  N = n1+n2
  Nsize=c(Nsize,N)
  df = ((n1-1)*(n2-1)*(sd1^2+sd2^2)^2)/((n2-1)*sd1^4+(n1-1)*sd2^4) 
  DF = c(DF,df)
  coeffmult = c(coeffmult,sqrt(df/2)*gamma((df-1)/2)/gamma(df/2))
}
```

```{r biascohendprimehomNsize2,fig.cap="...",echo=FALSE}
par(mfrow=c(1,2))
plot(Nsize,DF)
plot(Nsize,coeffmult)
```

  + The larger the total sample size, the lower the bias (see Figure \ref{fig:biascohendprimehomNsize2})

### When variances are unequal across populations, with equal sample sizes

When $n_1=n_2=n$: 
$$df_{Cohen's \; d'_s} = \frac{(n-1)^2(s^2_1+s^2_2)^2}{(n-1)(s^4_1+s^4_2)} =  \frac{(n-1)(s^4_1+s^4_2+2s^2_1s^2_2)}{s^4_1+s^4_2}$$ 
One can see that degrees of freedom depend only on the total sample size  (N) and the SD-ratio. As a consequence, the **bias** of Cohen's $d'_s$ is a function of the population effect size ($\delta'_{Cohen}$), the SD-ratio and the total sample size ($N$): 

  + The larger the population effect size, the more $Cohen's \; d'_s$ will overestimate $\delta'_{Cohen}$  

```{r biascohendprimehetbalSDratio,include=FALSE}
coeffmult <- NULL
SDratio <- NULL
DF <- NULL

for (i in 1:100){
  
  n1=100
  n2=100
  N <- n1+n2
  sd2 <- 10
  sd1 <- i
  
  SDratio <- c(SDratio,sd1/sd2)
  df <- ((n1-1)*(n2-1)*(sd1^2+sd2^2)^2)/((n2-1)*sd1^4+(n1-1)*sd2^4)
  DF <- c(DF,df)
  coeffmult <- c(coeffmult,sqrt(df/2)*gamma((df-1)/2)/gamma(df/2))   
}
```

```{r biascohendprimehetbalSDratio2,fig.cap="bias of Cohen's $d'_s$ as a function of the total sample size, when variances are equal across groups",echo=FALSE}
par(mfrow=c(1,2))
plot(log(SDratio),DF)
#SDratio[DF==max(DF)]
plot(log(SDratio),coeffmult)
#SDratio[coeffmult==min(coeffmult)]
```

  + The further the SD-ratio is from 1, the larger the bias (see Figure \ref{fig:biascohendprimehetbalSDratio2})  

```{r biascohendprimehetbalNsize,include=FALSE}
Nsize=NULL
coeffmult=NULL
DF=NULL

sd1=10
sd2=2

for (i in 4:200){
  n1=i
  n2=i
  N = n1+n2
  Nsize=c(Nsize,N)
  df = ((n1-1)*(n2-1)*(sd1^2+sd2^2)^2)/((n2-1)*sd1^4+(n1-1)*sd2^4) 
  DF = c(DF,df)
  coeffmult = c(coeffmult,sqrt(df/2)*gamma((df-1)/2)/gamma(df/2))
}
```

```{r biascohendprimehetbalNsize2,fig.cap="bias of Cohen's $d'_s$ as a function of the total sample size, when variances are equal across groups",echo=FALSE}
par(mfrow=c(1,2))
plot(Nsize,DF)
plot(Nsize,coeffmult)
```

  + The larger the total sample size, the lower the bias (see Figure \ref{fig:biascohendprimehetbalNsize2})  

```{r biascohendprimehetbalvariance,include=FALSE}
coeffmult <- NULL
SD1 <- NULL
DF <- NULL

for (i in 1:100){
  n1=100
  n2=100
  N <- n1+n2
  sdratio = 1/2
  sd1 <- i
  sd2 <- sdratio*i

  SD1 <- c(SD1,sd1)
  df <- ((n1-1)*(n2-1)*(sd1^2+sd2^2)^2)/((n2-1)*sd1^4+(n1-1)*sd2^4)
  DF <- c(DF,df)
  coeffmult <- c(coeffmult,sqrt(df/2)*gamma((df-1)/2)/gamma(df/2))   
}
```

```{r biascohendprimehetbalvariance2,fig.cap="bias of Cohen's $d'_s$ as a function of the total sample size, when variances are equal across groups",echo=FALSE}
par(mfrow=c(1,2))
plot(SD1,DF)
#SDratio[DF==max(DF)]
plot(SD1,coeffmult)
#SDratio[coeffmult==min(coeffmult)]
```

Note: for a constant SD-ratio, the size of the variance does not matter (see Figure \ref{fig:biascohendprimehetbalvariance2}) 

### When variances are unequal across populations, with unequal sample sizes

The **bias** of Cohen's $d'_s$ is a function of the population effect size ($\delta'_{Cohen}$), the total sample size, and the sample sizes and variances pairing :     

  + The larger the population effect size, the more $Cohen's \; d'_s$ will overestimate $\delta'_{Cohen}$  

```{r biascohendprimehetunbalNratio,include=FALSE}
coeffmult <- NULL
nratio <- NULL
DF <- NULL

for (i in 10:190){
  
  N <- 200
  n1 <- i
  n2 <- N-n1
  sd1 <- 2
  sd2 <- 10
  
  nratio <- c(nratio,n1/n2)
  df <- ((n1-1)*(n2-1)*(sd1^2+sd2^2)^2)/((n2-1)*sd1^4+(n1-1)*sd2^4)
  DF <- c(DF,df)
  coeffmult <- c(coeffmult,sqrt(df/2)*gamma((df-1)/2)/gamma(df/2))   
}

coeffmult2 <- NULL
nratio2 <- NULL
DF2 <- NULL

for (i in 10:190){
  
  N <- 200
  n1 <- i
  n2 <- N-n1
  sd1 <- 10
  sd2 <- 2
  
  nratio2 <- c(nratio2,n1/n2)
  df <- ((n1-1)*(n2-1)*(sd1^2+sd2^2)^2)/((n2-1)*sd1^4+(n1-1)*sd2^4)
  DF2 <- c(DF2,df)
  coeffmult2 <- c(coeffmult2,sqrt(df/2)*gamma((df-1)/2)/gamma(df/2))   
}

```

```{r biascohendprimehetunbalNratio2,fig.cap="bias of Cohen's $d'_s$ as a function of the total sample size, when variances are equal across groups",echo=FALSE}
par(mfrow=c(2,2))
plot(log(nratio),DF)
abline(v=0)
plot(log(nratio),coeffmult)
abline(v=0)

plot(log(nratio2),DF2)
abline(v=0)
plot(log(nratio2),coeffmult2)
abline(v=0)

```

  + When there is a positive pairing between sample sizes and variances, one gives more weight to the smallest variance. As a consequence, the denominator in the df computation decreases, the degrees of freedom increase and therefore, the bias decreases (see the two plots on the top in Figure \ref{fig:biascohendprimehetbalNsize2}).  On the other size, where there is a negative pairing between sample sizes and variances, one gives more weight to the largest variance. As a consequence, the denominator in the df computatin increases, the degrees of freedom decrease and therefore, the bias increase (see the two plots in the bottom of Figure \ref{fig:biascohendprimehetbalNsize2}).   

```{r biascohendprimehetunbalNsize,include=FALSE}
coeffmult <- NULL
Nsize <- NULL
DF <- NULL

for (i in 2:200){
  
  n1 <- i
  n2 <- 12*i
  N <- n1+n2
  sd1 <- 1.8
  sd2 <- 1
  
  df <- ((n1-1)*(n2-1)*(sd1^2+sd2^2)^2)/((n2-1)*sd1^4+(n1-1)*sd2^4)
  DF <- c(DF,df)
  Nsize <- c(Nsize,N)
  coeffmult <- c(coeffmult,sqrt(df/2)*gamma((df-1)/2)/gamma(df/2))   
}

```

```{r biascohendprimehetunbalNsize2,fig.cap="bias of Cohen's $d'_s$ as a function of the total sample size, when variances are equal across groups",echo=FALSE}
par(mfrow=c(2,2))
plot(Nsize,DF)
abline(v=0)
plot(Nsize,coeffmult)
abline(v=0)
```

  + The larger the total sample size, the lower the bias (illustration in Figure \ref{fig:biascohendprimehetunbalNsize2})

```{r biascohendprimehetunbalvariance,include=FALSE}
coeffmult <- NULL
SD1 <- NULL
DF <- NULL

for (i in 2:200){
  
  n1 <- 23
  n2 <- 75
  N <- n1+n2
  sd1 <- 2*i
  sd2 <- i
  
  df <- ((n1-1)*(n2-1)*(sd1^2+sd2^2)^2)/((n2-1)*sd1^4+(n1-1)*sd2^4)
  DF <- c(DF,df)
  SD1 <- c(SD1,sd1)
  coeffmult <- c(coeffmult,sqrt(df/2)*gamma((df-1)/2)/gamma(df/2))   
}

```

```{r biascohendprimehetunbalvariance2,fig.cap="bias of Cohen's $d'_s$ as a function of the total sample size, when variances are equal across groups",echo=FALSE}
par(mfrow=c(2,2))
plot(SD1,DF)
abline(v=0)
plot(SD1,coeffmult)
abline(v=0)
```
  
Note: for a constant SD-ratio, the variance does not matter. (See Figure \ref{fig:biascohendprimehetunbalvariance2})


```{r ,include=FALSE}
```

```{r ,fig.cap="bias of Cohen's $d'_s$ as a function of the total sample size, when variances are equal across groups",echo=FALSE}
par(mfrow=c(1,2))
```

## Shieh's $d_s$

### When variances are equal across populations
### When variances are unequal across populations, with equal sample sizes
### When variances are unequal across populations, with unequal sample sizes

# The variance 

## Cohen's $d_s$

### When variances are equal across populations

## Glass's $d_s$

### When variances are equal across populations
* The **variance** of Cohen's $\delta'_s$ is a function of ...:
  + ...
  + ...  

### When variances are unequal across populations, with equal sample sizes
* The **variance** of Cohen's $\delta'_s$ is a function of ...:
  + ...
  + ...  

### When variances are unequal across populations, with unequal sample sizes
* The **variance** of Cohen's $\delta'_s$ is a function of ...:
  + ...
  + ...  

## Cohen's $d'_s$

### When variances are equal across populations
* The **variance** of Cohen's $\delta'_s$ is a function of ...:
  + ...
  + ...  

### When variances are unequal across populations, with equal sample sizes
* The **variance** of Cohen's $\delta'_s$ is a function of ...:
  + ...
  + ...  

### When variances are unequal across populations, with unequal sample sizes
* The **variance** of Cohen's $\delta'_s$ is a function of ...:
  + ...
  + ...  

## Shieh's $d_s$

### When variances are equal across populations
* The **variance** of Cohen's $\delta'_s$ is a function of ...:
  + ...
  + ...  

### When variances are unequal across populations, with equal sample sizes
* The **variance** of Cohen's $\delta'_s$ is a function of ...:
  + ...
  + ...  

### When variances are unequal across populations, with unequal sample sizes
* The **variance** of Cohen's $\delta'_s$ is a function of ...:
  + ...
  + ...  
